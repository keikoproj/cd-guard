package cmd

import (
	"bou.ke/monkey"
	"github.com/stretchr/testify/assert"
	"k8s.io/apimachinery/pkg/util/json"
	"os"
	"testing"

	argoappv1 "github.com/argoproj/argo-cd/pkg/apis/application/v1alpha1"
)

const deployDiff = `{"group":"apps","kind":"Deployment","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-deployment","targetState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}","liveState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":47,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258525537\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":2,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":2,\"conditions\":[{\"lastTransitionTime\":\"2019-06-03T20:52:45Z\",\"lastUpdateTime\":\"2019-06-03T20:52:45Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"},{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T20:59:38Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" is progressing.\",\"reason\":\"ReplicaSetUpdated\",\"status\":\"True\",\"type\":\"Progressing\"}],\"observedGeneration\":47,\"readyReplicas\":2,\"replicas\":3,\"unavailableReplicas\":1,\"updatedReplicas\":2}}"}`

func TestApplyLastAppliedConfigPatch(t *testing.T) {

	deploymentNames := make([]string, 1)
	deploymentNames[0] = "hpa-samples-appd-deployment"

	deployments := make(map[string]*argoappv1.ResourceDiff)

	resourceDiff := toResourceDiff(t, deployDiff)
	deployments["hpa-samples-appd-deployment"] = &resourceDiff

	applyLastAppliedConfigPatch(nil, nil, "dev-containers-hpa-samples-usw2-ppd-qal", deploymentNames, deployments, true)

}

func toResourceDiff(t *testing.T, str string) argoappv1.ResourceDiff {
	deployObject := make(map[string]interface{})
	if json.Unmarshal([]byte(str), &deployObject) != nil {
		t.Errorf("Parsing json error:%s", str)
	}

	return converToResourceDiff(deployObject)
}

func converToResourceDiff(obj map[string]interface{}) argoappv1.ResourceDiff {
	group := obj["group"]
	if group != nil {
		group = group.(string)
	} else {
		group = ""
	}
	resourceDiff := argoappv1.ResourceDiff{
		Group:       group.(string),
		Kind:        obj["kind"].(string),
		Namespace:   obj["namespace"].(string),
		Name:        obj["name"].(string),
		TargetState: obj["targetState"].(string),
		LiveState:   obj["liveState"].(string),
		Diff:        "",
	}
	return resourceDiff
}

func toResourceDiffs(t *testing.T, str string) []*argoappv1.ResourceDiff {
	itemsObj := make(map[string]interface{})
	err := json.Unmarshal([]byte(str), &itemsObj)
	if err != nil {
		t.Errorf("Parsing json error:%s \r\n %v", str, err)
	}

	items := itemsObj["items"].([]interface{})

	resourceDiffs := make([]*argoappv1.ResourceDiff, len(items))
	for i := range items {
		obj := items[i].(map[string]interface{})
		resourceDiff := converToResourceDiff(obj)
		resourceDiffs[i] = &resourceDiff
	}
	return resourceDiffs
}

const noHPA = `{"items":[{"kind":"Service","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-service","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"},{"group":"apps","kind":"Deployment","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-deployment","targetState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"replicas\":3,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}","liveState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"replicas\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":50,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258543579\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":3,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":3,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":50,\"readyReplicas\":3,\"replicas\":3,\"updatedReplicas\":3}}"},{"group":"extensions","kind":"Ingress","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-ingress","targetState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}","liveState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"}]}`

// No change is required
func TestNoHpa(t *testing.T) {
	diffs := toResourceDiffs(t, noHPA)
	_, _, _, result := verifyHpa(diffs)
	assert.EqualValues(t, result, 200)
}

// Enable HPA
const enableHPA = `
{"items":[{"group":"autoscaling","kind":"HorizontalPodAutoscaler","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-hpa","targetState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}}}","liveState":"null","diff":"{\n  \"apiVersion\": [\n    \"autoscaling/v2beta1\"\n  ],\n  \"kind\": [\n    \"HorizontalPodAutoscaler\"\n  ],\n  \"metadata\": [\n    {\n      \"labels\": {\n        \"app\": \"hpa-samples\",\n        \"applications.argoproj.io/app-name\": \"dev-containers-hpa-samples-usw2-ppd-qal\"\n      },\n      \"name\": \"hpa-samples-hpa\"\n    }\n  ],\n  \"spec\": [\n    {\n      \"maxReplicas\": 10,\n      \"metrics\": [\n        {\n          \"object\": {\n            \"metricName\": \"namespace_app_pod_cpu_utilization\",\n            \"target\": {\n              \"apiVersion\": \"apps/v1beta2\",\n              \"kind\": \"Deployment\",\n              \"name\": \"hpa-samples\"\n            },\n            \"targetValue\": \"80\"\n          },\n          \"type\": \"Object\"\n        }\n      ],\n      \"minReplicas\": 2,\n      \"scaleTargetRef\": {\n        \"apiVersion\": \"apps/v1beta2\",\n        \"kind\": \"Deployment\",\n        \"name\": \"hpa-samples-appd-deployment\"\n      }\n    }\n  ]\n}\n"},{"group":"extensions","kind":"Ingress","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-ingress","targetState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}","liveState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"},{"kind":"Service","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-service","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"},{"group":"apps","kind":"Deployment","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-deployment","targetState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}","liveState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"replicas\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":50,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258543579\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":3,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":3,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":50,\"readyReplicas\":3,\"replicas\":3,\"updatedReplicas\":3}}","diff":"{\n  \"spec\": {\n    \"replicas\": [\n      3,\n      0,\n      0\n    ]\n  }\n}\n"}]}`

func TestEnableHpa(t *testing.T) {
	diffs := toResourceDiffs(t, enableHPA)
	hpas, names, deploys, result := verifyHpa(diffs)
	assert.EqualValues(t, result, 0)
	assert.EqualValues(t, len(hpas), 1)

	applyLastAppliedConfigPatch(nil, nil, "dev-containers-hpa-samples-usw2-ppd-qal", names, deploys, true)

}

const withHPA = `
{"items":[{"group":"apps","kind":"Deployment","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-deployment","targetState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}","liveState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":53,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258581681\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":2,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":2,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":53,\"readyReplicas\":2,\"replicas\":2,\"updatedReplicas\":2}}"},{"group":"autoscaling","kind":"HorizontalPodAutoscaler","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-hpa","targetState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}}}","liveState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"autoscaling/v2beta1\\\",\\\"kind\\\":\\\"HorizontalPodAutoscaler\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-hpa\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"maxReplicas\\\":10,\\\"metrics\\\":[{\\\"object\\\":{\\\"metricName\\\":\\\"namespace_app_pod_cpu_utilization\\\",\\\"target\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"hpa-samples\\\"},\\\"targetValue\\\":\\\"80\\\"},\\\"type\\\":\\\"Object\\\"}],\\\"minReplicas\\\":2,\\\"scaleTargetRef\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"hpa-samples-appd-deployment\\\"}}}\\n\"},\"creationTimestamp\":\"2019-06-03T22:37:25Z\",\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258582550\",\"selfLink\":\"/apis/autoscaling/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/horizontalpodautoscalers/hpa-samples-hpa\",\"uid\":\"28ba3570-8650-11e9-9918-02aee870c79e\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}},\"status\":{\"conditions\":[{\"lastTransitionTime\":\"2019-06-03T22:39:25Z\",\"message\":\"the time since the previous scale is still within both the downscale and upscale forbidden windows\",\"reason\":\"BackoffBoth\",\"status\":\"False\",\"type\":\"AbleToScale\"},{\"lastTransitionTime\":\"2019-06-03T22:37:55Z\",\"message\":\"the HPA was able to successfully calculate a replica count from Deployment metric namespace_app_pod_cpu_utilization\",\"reason\":\"ValidMetricFound\",\"status\":\"True\",\"type\":\"ScalingActive\"},{\"lastTransitionTime\":\"2019-06-03T22:37:55Z\",\"message\":\"the desired replica count is increasing faster than the maximum scale rate\",\"reason\":\"TooFewReplicas\",\"status\":\"True\",\"type\":\"ScalingLimited\"}],\"currentMetrics\":[{\"object\":{\"currentValue\":\"3022m\",\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"}},\"type\":\"Object\"}],\"currentReplicas\":2,\"desiredReplicas\":2,\"lastScaleTime\":\"2019-06-03T22:37:55Z\"}}"},{"group":"extensions","kind":"Ingress","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-ingress","targetState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}","liveState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"},{"kind":"Service","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-service","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"}]}`

//Test HPA and noReplicas applied
func TestApplied(t *testing.T) {
	diffs := toResourceDiffs(t, withHPA)
	_, _, _, result := verifyHpa(diffs)
	assert.EqualValues(t, result, 0)
}

const withDeploymentChange = `{"items":[{"kind":"Service","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-service","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"},{"group":"apps","kind":"Deployment","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-deployment","targetState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"123\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}","liveState":"{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"6\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"123\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":54,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258587312\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":2,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"123\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":2,\"conditions\":[{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"},{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T22:47:42Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-697bc56d77\\\" is progressing.\",\"reason\":\"ReplicaSetUpdated\",\"status\":\"True\",\"type\":\"Progressing\"}],\"observedGeneration\":54,\"readyReplicas\":2,\"replicas\":3,\"unavailableReplicas\":1,\"updatedReplicas\":1}}"},{"group":"autoscaling","kind":"HorizontalPodAutoscaler","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-hpa","targetState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}}}","liveState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"autoscaling/v2beta1\\\",\\\"kind\\\":\\\"HorizontalPodAutoscaler\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-hpa\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"maxReplicas\\\":10,\\\"metrics\\\":[{\\\"object\\\":{\\\"metricName\\\":\\\"namespace_app_pod_cpu_utilization\\\",\\\"target\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"hpa-samples\\\"},\\\"targetValue\\\":\\\"80\\\"},\\\"type\\\":\\\"Object\\\"}],\\\"minReplicas\\\":2,\\\"scaleTargetRef\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"hpa-samples-appd-deployment\\\"}}}\\n\"},\"creationTimestamp\":\"2019-06-03T22:37:25Z\",\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258587716\",\"selfLink\":\"/apis/autoscaling/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/horizontalpodautoscalers/hpa-samples-hpa\",\"uid\":\"28ba3570-8650-11e9-9918-02aee870c79e\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}},\"status\":{\"conditions\":[{\"lastTransitionTime\":\"2019-06-03T22:48:25Z\",\"message\":\"the time since the previous scale is still within both the downscale and upscale forbidden windows\",\"reason\":\"BackoffBoth\",\"status\":\"False\",\"type\":\"AbleToScale\"},{\"lastTransitionTime\":\"2019-06-03T22:37:55Z\",\"message\":\"the HPA was able to successfully calculate a replica count from Deployment metric namespace_app_pod_cpu_utilization\",\"reason\":\"ValidMetricFound\",\"status\":\"True\",\"type\":\"ScalingActive\"},{\"lastTransitionTime\":\"2019-06-03T22:37:55Z\",\"message\":\"the desired replica count is increasing faster than the maximum scale rate\",\"reason\":\"TooFewReplicas\",\"status\":\"True\",\"type\":\"ScalingLimited\"}],\"currentMetrics\":[{\"object\":{\"currentValue\":\"4987m\",\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"}},\"type\":\"Object\"}],\"currentReplicas\":3,\"desiredReplicas\":3,\"lastScaleTime\":\"2019-06-03T22:47:55Z\"}}"},{"group":"extensions","kind":"Ingress","namespace":"dev-containers-hpa-samples-usw2-ppd-qal","name":"hpa-samples-appd-ingress","targetState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}","liveState":"{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"}]}`

func TestDeploymentChange(t *testing.T) {
	diffs := toResourceDiffs(t, withDeploymentChange)
	_, _, _, result := verifyHpa(diffs)
	assert.EqualValues(t, result, 0)
}

const withDeploymentChangeName = `
{
  "items": [
    {
      "kind": "Service",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-service",
      "targetState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}",
      "liveState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"
    },
    {
      "group": "apps",
      "kind": "Deployment",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-deployment-new",
      "targetState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"123\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}",
      "liveState": ""
    },
    {
      "group": "autoscaling",
      "kind": "HorizontalPodAutoscaler",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-hpa",
      "targetState": "{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}}}",
      "liveState": "{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"autoscaling/v2beta1\\\",\\\"kind\\\":\\\"HorizontalPodAutoscaler\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-hpa\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"maxReplicas\\\":10,\\\"metrics\\\":[{\\\"object\\\":{\\\"metricName\\\":\\\"namespace_app_pod_cpu_utilization\\\",\\\"target\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"hpa-samples\\\"},\\\"targetValue\\\":\\\"80\\\"},\\\"type\\\":\\\"Object\\\"}],\\\"minReplicas\\\":2,\\\"scaleTargetRef\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"hpa-samples-appd-deployment\\\"}}}\\n\"},\"creationTimestamp\":\"2019-06-03T22:37:25Z\",\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-hpa\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258587716\",\"selfLink\":\"/apis/autoscaling/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/horizontalpodautoscalers/hpa-samples-hpa\",\"uid\":\"28ba3570-8650-11e9-9918-02aee870c79e\"},\"spec\":{\"maxReplicas\":10,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"},\"targetValue\":\"80\"},\"type\":\"Object\"}],\"minReplicas\":2,\"scaleTargetRef\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples-appd-deployment\"}},\"status\":{\"conditions\":[{\"lastTransitionTime\":\"2019-06-03T22:48:25Z\",\"message\":\"the time since the previous scale is still within both the downscale and upscale forbidden windows\",\"reason\":\"BackoffBoth\",\"status\":\"False\",\"type\":\"AbleToScale\"},{\"lastTransitionTime\":\"2019-06-03T22:37:55Z\",\"message\":\"the HPA was able to successfully calculate a replica count from Deployment metric namespace_app_pod_cpu_utilization\",\"reason\":\"ValidMetricFound\",\"status\":\"True\",\"type\":\"ScalingActive\"},{\"lastTransitionTime\":\"2019-06-03T22:37:55Z\",\"message\":\"the desired replica count is increasing faster than the maximum scale rate\",\"reason\":\"TooFewReplicas\",\"status\":\"True\",\"type\":\"ScalingLimited\"}],\"currentMetrics\":[{\"object\":{\"currentValue\":\"4987m\",\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"hpa-samples\"}},\"type\":\"Object\"}],\"currentReplicas\":3,\"desiredReplicas\":3,\"lastScaleTime\":\"2019-06-03T22:47:55Z\"}}"
    },
    {
      "group": "extensions",
      "kind": "Ingress",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-ingress",
      "targetState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}",
      "liveState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"
    }
  ]
}
`

func TestDeploymentChangeName(t *testing.T) {
	fakeExit := func(int) {
		panic(301)
	}
	patch := monkey.Patch(os.Exit, fakeExit)
	defer patch.Unpatch()

	f := func() {
		diffs := toResourceDiffs(t, withDeploymentChangeName)
		verifyHpa(diffs)
	}

	assert.PanicsWithValue(t, 301, f)
}

const rolloutWithNoReplicas = `
{"items":[{"group":"batch","kind":"CronJob","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"web-service-integration-cgds-transfer","targetState":"{\"apiVersion\":\"batch/v1beta1\",\"kind\":\"CronJob\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration-cgds-transfer\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"concurrencyPolicy\":\"Forbid\",\"failedJobsHistoryLimit\":2,\"jobTemplate\":{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"splunk-sourcetype\":\"{\\\"web-service-integration\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"}}\"},\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"assetId\":\"5766876915036502990\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"perf\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"wsi_env\",\"value\":\"prf\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-cgds:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-663-eb834c9\",\"name\":\"web-service-integration-cgds-transfer\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prf\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::727785010965:role/shared.ifdp-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-2jpbzwj26egg\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"OnFailure\",\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}},\"schedule\":\"10,40 * * * *\",\"successfulJobsHistoryLimit\":2}}","liveState":"{\"apiVersion\":\"batch/v1beta1\",\"kind\":\"CronJob\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"batch/v1beta1\\\",\\\"kind\\\":\\\"CronJob\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"prf\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\"},\\\"name\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"concurrencyPolicy\\\":\\\"Forbid\\\",\\\"failedJobsHistoryLimit\\\":2,\\\"jobTemplate\\\":{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-fdp-connectivity-web-service-integration-usw2-ppd-prf\\\",\\\"splunk-sourcetype\\\":\\\"{\\\\\\\"web-service-integration\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsi\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsi\\\\\\\"}}\\\"},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"env\\\":\\\"prf\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\",\\\"splunk-index\\\":\\\"perf\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"wsi_env\\\",\\\"value\\\":\\\"prf\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-cgds:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-663-eb834c9\\\",\\\"name\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"},{\\\"mountPath\\\":\\\"/cgds\\\",\\\"name\\\":\\\"wsiefs\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prf\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::727785010965:role/shared.ifdp-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-2jpbzwj26egg\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-f\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7jtfjlz1n7rt\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS_CERT\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-cert\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"restartPolicy\\\":\\\"OnFailure\\\",\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"},{\\\"name\\\":\\\"wsiefs\\\",\\\"persistentVolumeClaim\\\":{\\\"claimName\\\":\\\"web-service-integration-efs-pvc\\\"}}]}}}},\\\"schedule\\\":\\\"10,40 * * * *\\\",\\\"successfulJobsHistoryLimit\\\":2}}\\n\"},\"creationTimestamp\":\"2019-06-06T00:45:05Z\",\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration-cgds-transfer\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"145758263\",\"selfLink\":\"/apis/batch/v1beta1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/cronjobs/web-service-integration-cgds-transfer\",\"uid\":\"539e3fbe-87f4-11e9-a794-023f0b494966\"},\"spec\":{\"concurrencyPolicy\":\"Forbid\",\"failedJobsHistoryLimit\":2,\"jobTemplate\":{\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"splunk-sourcetype\":\"{\\\"web-service-integration\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"}}\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"assetId\":\"5766876915036502990\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"perf\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"wsi_env\",\"value\":\"prf\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-cgds:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-663-eb834c9\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"web-service-integration-cgds-transfer\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prf\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::727785010965:role/shared.ifdp-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-2jpbzwj26egg\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"idpsloader-cert\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"OnFailure\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}},\"schedule\":\"10,40 * * * *\",\"successfulJobsHistoryLimit\":2,\"suspend\":false},\"status\":{\"lastScheduleTime\":\"2019-06-22T00:10:00Z\"}}"},{"group":"autoscaling","kind":"HorizontalPodAutoscaler","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"web-service-integration","targetState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"maxReplicas\":20,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"web-service-integration\"},\"targetValue\":\"30\"},\"type\":\"Object\"}],\"minReplicas\":4,\"scaleTargetRef\":{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"name\":\"web-service-integration\"}}}","liveState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"autoscaling/v2beta1\\\",\\\"kind\\\":\\\"HorizontalPodAutoscaler\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"name\\\":\\\"web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"maxReplicas\\\":20,\\\"metrics\\\":[{\\\"object\\\":{\\\"metricName\\\":\\\"namespace_app_pod_cpu_utilization\\\",\\\"target\\\":{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"name\\\":\\\"web-service-integration\\\"},\\\"targetValue\\\":\\\"30\\\"},\\\"type\\\":\\\"Object\\\"}],\\\"minReplicas\\\":4,\\\"scaleTargetRef\\\":{\\\"apiVersion\\\":\\\"argoproj.io/v1alpha1\\\",\\\"kind\\\":\\\"Rollout\\\",\\\"name\\\":\\\"web-service-integration\\\"}}}\\n\"},\"creationTimestamp\":\"2019-06-21T17:12:45Z\",\"labels\":{\"app\":\"web-service-integration\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"145766440\",\"selfLink\":\"/apis/autoscaling/v1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/horizontalpodautoscalers/web-service-integration\",\"uid\":\"c971eaf5-9447-11e9-9b97-0675512824ee\"},\"spec\":{\"maxReplicas\":20,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"web-service-integration\"},\"targetValue\":\"30\"},\"type\":\"Object\"}],\"minReplicas\":4,\"scaleTargetRef\":{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"name\":\"web-service-integration\"}},\"status\":{\"conditions\":[{\"lastTransitionTime\":\"2019-06-21T23:12:35Z\",\"message\":\"recommended size matches current size\",\"reason\":\"ReadyForNewScale\",\"status\":\"True\",\"type\":\"AbleToScale\"},{\"lastTransitionTime\":\"2019-06-21T18:22:20Z\",\"message\":\"the HPA was able to successfully calculate a replica count from Deployment metric namespace_app_pod_cpu_utilization\",\"reason\":\"ValidMetricFound\",\"status\":\"True\",\"type\":\"ScalingActive\"},{\"lastTransitionTime\":\"2019-06-21T23:54:22Z\",\"message\":\"the desired replica count is increasing faster than the maximum scale rate\",\"reason\":\"TooFewReplicas\",\"status\":\"True\",\"type\":\"ScalingLimited\"}],\"currentMetrics\":[{\"object\":{\"currentValue\":\"702m\",\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"web-service-integration\"}},\"type\":\"Object\"}],\"currentReplicas\":4,\"desiredReplicas\":4,\"lastScaleTime\":\"2019-06-21T23:53:37Z\"}}"},{"group":"argoproj.io","kind":"Rollout","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"web-service-integration","targetState":"{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"revisionHistoryLimit\":3,\"selector\":{\"matchLabels\":{\"app\":\"web-service-integration\"}},\"strategy\":{\"blueGreen\":{\"activeService\":\"active-web-service-integration\",\"autoPromotionEnabled\":false,\"previewService\":\"preview-web-service-integration\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"HTTP\",\"prometheus.io/scrape\":\"true\",\"splunk-sourcetype\":\"{\\\"wsi-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"} , \\\"perflog-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsiperf\\\", \\\"stderr\\\": \\\"fdpwsiperf\\\"} , \\\"oil-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsioil\\\", \\\"stderr\\\": \\\"fdpwsioil\\\"}, \\\"cgds-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsicgds\\\", \\\"stderr\\\": \\\"fdpwsicgds\\\"}}\"},\"labels\":{\"app\":\"web-service-integration\",\"assetId\":\"5766876915036502990\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"perf\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prf\"},{\"name\":\"APP_ENV_PROPERTIES\",\"value\":\"prf\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"L1\",\"value\":\"fdp\"},{\"name\":\"L2\",\"value\":\"connectivity\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app-iks\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-PR-500-2-0f13586\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"web-service-integration\",\"ports\":[{\"containerPort\":8080,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"12G\"},\"requests\":{\"cpu\":\"2\",\"memory\":\"12G\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/usr/local/tomcat/logs/\",\"name\":\"varlog\"},{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice-perf.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"perflog-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsi-oil.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"oil-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"wsi-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/cgds\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"cgds-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"env\":[{\"name\":\"IDPS_APPLIANCE_URL\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"SEC_TOOLS_SECRETS_ROOT_DIR\",\"value\":\"/secrets/sigsci-agent\"}],\"image\":\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\",\"name\":\"sigsci-agent-container\",\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"}]},{\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-PR-500-2-0f13586\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"envoy-proxy\",\"ports\":[{\"containerPort\":443,\"name\":\"envoy-service\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"1500M\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"1500M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/envoy\",\"name\":\"envoy-config\",\"readOnly\":true},{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prf\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::727785010965:role/shared.ifdp-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-2jpbzwj26egg\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-l\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/application_secrets.properties\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-secrets\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"configMap\":{\"items\":[{\"key\":\"envoy.yaml\",\"path\":\"envoy.yaml\"}],\"name\":\"envoy-config\"},\"name\":\"envoy-config\"},{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"emptyDir\":{},\"name\":\"varlog\"},{\"emptyDir\":{},\"name\":\"sigscisharedvolume\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}}","liveState":"{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"argoproj.io/v1alpha1\\\",\\\"kind\\\":\\\"Rollout\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"prf\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\"},\\\"name\\\":\\\"web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"revisionHistoryLimit\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"web-service-integration\\\"}},\\\"strategy\\\":{\\\"blueGreen\\\":{\\\"activeService\\\":\\\"active-web-service-integration\\\",\\\"autoPromotionEnabled\\\":false,\\\"previewService\\\":\\\"preview-web-service-integration\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-fdp-connectivity-web-service-integration-usw2-ppd-prf\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"HTTP\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\",\\\"splunk-sourcetype\\\":\\\"{\\\\\\\"wsi-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsi\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsi\\\\\\\"} , \\\\\\\"perflog-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsiperf\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsiperf\\\\\\\"} , \\\\\\\"oil-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsioil\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsioil\\\\\\\"}, \\\\\\\"cgds-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsicgds\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsicgds\\\\\\\"}}\\\"},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"env\\\":\\\"prf\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\",\\\"splunk-index\\\":\\\"perf\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prf\\\"},{\\\"name\\\":\\\"APP_ENV_PROPERTIES\\\",\\\"value\\\":\\\"prf\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"fdp\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"connectivity\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app-iks\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-PR-500-2-0f13586\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8080,\\\"scheme\\\":\\\"HTTP\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"web-service-integration\\\",\\\"ports\\\":[{\\\"containerPort\\\":8080,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8080,\\\"scheme\\\":\\\"HTTP\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"2\\\",\\\"memory\\\":\\\"12G\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"2\\\",\\\"memory\\\":\\\"12G\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"},{\\\"mountPath\\\":\\\"/usr/local/tomcat/logs/\\\",\\\"name\\\":\\\"varlog\\\"},{\\\"mountPath\\\":\\\"/var/run/sigsci\\\",\\\"name\\\":\\\"sigscisharedvolume\\\"},{\\\"mountPath\\\":\\\"/cgds\\\",\\\"name\\\":\\\"wsiefs\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsiservice-perf.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"perflog-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsi-oil.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"oil-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsiservice.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"wsi-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/cgds\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"cgds-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"100m\\\",\\\"memory\\\":\\\"64M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"env\\\":[{\\\"name\\\":\\\"IDPS_APPLIANCE_URL\\\",\\\"value\\\":\\\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7jtfjlz1n7rt\\\"},{\\\"name\\\":\\\"SEC_TOOLS_SECRETS_ROOT_DIR\\\",\\\"value\\\":\\\"/secrets/sigsci-agent\\\"}],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\\\",\\\"name\\\":\\\"sigsci-agent-container\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"400m\\\",\\\"memory\\\":\\\"400Mi\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"400m\\\",\\\"memory\\\":\\\"400Mi\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/run/sigsci\\\",\\\"name\\\":\\\"sigscisharedvolume\\\"}]},{\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-PR-500-2-0f13586\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8002,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"envoy-proxy\\\",\\\"ports\\\":[{\\\"containerPort\\\":443,\\\"name\\\":\\\"envoy-service\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8002,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"400m\\\",\\\"memory\\\":\\\"1500M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"400m\\\",\\\"memory\\\":\\\"1500M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/envoy\\\",\\\"name\\\":\\\"envoy-config\\\",\\\"readOnly\\\":true},{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prf\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::727785010965:role/shared.ifdp-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-2jpbzwj26egg\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-l\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7jtfjlz1n7rt\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/application_secrets.properties\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-secrets\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-f\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7jtfjlz1n7rt\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS_CERT\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-cert\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"configMap\\\":{\\\"items\\\":[{\\\"key\\\":\\\"envoy.yaml\\\",\\\"path\\\":\\\"envoy.yaml\\\"}],\\\"name\\\":\\\"envoy-config\\\"},\\\"name\\\":\\\"envoy-config\\\"},{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"},{\\\"emptyDir\\\":{},\\\"name\\\":\\\"varlog\\\"},{\\\"emptyDir\\\":{},\\\"name\\\":\\\"sigscisharedvolume\\\"},{\\\"name\\\":\\\"wsiefs\\\",\\\"persistentVolumeClaim\\\":{\\\"claimName\\\":\\\"web-service-integration-efs-pvc\\\"}}]}}}}\\n\",\"rollout.argoproj.io/revision\":\"42\"},\"creationTimestamp\":\"2019-05-15T18:22:23Z\",\"generation\":1218,\"labels\":{\"app\":\"web-service-integration\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"145740976\",\"selfLink\":\"/apis/argoproj.io/v1alpha1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/rollouts/web-service-integration\",\"uid\":\"62905fe4-773e-11e9-91ce-020afa510d1a\"},\"spec\":{\"minReadySeconds\":0,\"paused\":false,\"replicas\":4,\"revisionHistoryLimit\":3,\"selector\":{\"matchLabels\":{\"app\":\"web-service-integration\"}},\"strategy\":{\"blueGreen\":{\"activeService\":\"active-web-service-integration\",\"autoPromotionEnabled\":false,\"previewService\":\"preview-web-service-integration\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"HTTP\",\"prometheus.io/scrape\":\"true\",\"splunk-sourcetype\":\"{\\\"wsi-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"} , \\\"perflog-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsiperf\\\", \\\"stderr\\\": \\\"fdpwsiperf\\\"} , \\\"oil-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsioil\\\", \\\"stderr\\\": \\\"fdpwsioil\\\"}, \\\"cgds-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsicgds\\\", \\\"stderr\\\": \\\"fdpwsicgds\\\"}}\"},\"labels\":{\"app\":\"web-service-integration\",\"assetId\":\"5766876915036502990\",\"env\":\"prf\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"perf\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prf\"},{\"name\":\"APP_ENV_PROPERTIES\",\"value\":\"prf\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"L1\",\"value\":\"fdp\"},{\"name\":\"L2\",\"value\":\"connectivity\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app-iks\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-PR-500-2-0f13586\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"web-service-integration\",\"ports\":[{\"containerPort\":8080,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"12G\"},\"requests\":{\"cpu\":\"2\",\"memory\":\"12G\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/usr/local/tomcat/logs/\",\"name\":\"varlog\"},{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice-perf.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"perflog-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsi-oil.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"oil-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"wsi-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/cgds\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"cgds-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"env\":[{\"name\":\"IDPS_APPLIANCE_URL\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"SEC_TOOLS_SECRETS_ROOT_DIR\",\"value\":\"/secrets/sigsci-agent\"}],\"image\":\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\",\"name\":\"sigsci-agent-container\",\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"}]},{\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-PR-500-2-0f13586\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"envoy-proxy\",\"ports\":[{\"containerPort\":443,\"name\":\"envoy-service\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"1500M\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"1500M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/envoy\",\"name\":\"envoy-config\",\"readOnly\":true},{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prf\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::727785010965:role/shared.ifdp-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-2jpbzwj26egg\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-l\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/application_secrets.properties\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-secrets\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"WSI-PRE-PRODUCTION-IFO91N.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-7jtfjlz1n7rt\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"configMap\":{\"items\":[{\"key\":\"envoy.yaml\",\"path\":\"envoy.yaml\"}],\"name\":\"envoy-config\"},\"name\":\"envoy-config\"},{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"emptyDir\":{},\"name\":\"varlog\"},{\"emptyDir\":{},\"name\":\"sigscisharedvolume\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}},\"status\":{\"HPAReplicas\":4,\"availableReplicas\":4,\"blueGreen\":{\"activeSelector\":\"6758574447\"},\"canary\":{},\"conditions\":[{\"lastTransitionTime\":\"2019-06-21T23:08:35Z\",\"lastUpdateTime\":\"2019-06-21T23:08:37Z\",\"message\":\"ReplicaSet \\\"web-service-integration-6758574447\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-21T23:53:40Z\",\"lastUpdateTime\":\"2019-06-21T23:53:40Z\",\"message\":\"Rollout has minimum availability\",\"reason\":\"AvailableReason\",\"status\":\"True\",\"type\":\"Available\"}],\"currentPodHash\":\"6758574447\",\"observedGeneration\":\"7447666587\",\"readyReplicas\":4,\"replicas\":4,\"selector\":\"app=web-service-integration,rollouts-pod-template-hash=6758574447\",\"updatedReplicas\":4}}"},{"kind":"ConfigMap","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"envoy-config","targetState":"{\"apiVersion\":\"v1\",\"data\":{\"envoy.yaml\":\"static_resources:\\n  listeners:\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 443\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.key\\\"\\n          validation_context:\\n            trusted_ca:\\n              filename: \\\"/etc/secrets/das-wsi-qa-ma.fdsqapci.a.intuit.com.crt\\\"\\n            verify_certificate_spki: \\\"5fcSNapmJ5GJTeny4GXr+MTWSM+CaJ55Pbb7btDILyY=\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/wsi/\\\"\\n                route:\\n                  cluster: wsi\\n                  timeout: 300s\\n              - match:\\n                  prefix: \\\"/app-info\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 8002\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.key\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/health/full\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  clusters:\\n  - name: wsi\\n    connect_timeout: 0.25s\\n    type: strict_dns\\n    lb_policy: round_robin\\n    load_assignment:\\n      cluster_name: wsi\\n      endpoints:\\n      - lb_endpoints:\\n        - endpoint:\\n            address:\\n              socket_address:\\n                address: 127.0.0.1\\n                port_value: 8080\\nadmin:\\n  access_log_path: \\\"/dev/stdout\\\"\\n  address:\\n    socket_address:\\n      address: 0.0.0.0\\n      port_value: 8001\\n\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"envoy-config\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"}}","liveState":"{\"apiVersion\":\"v1\",\"data\":{\"envoy.yaml\":\"static_resources:\\n  listeners:\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 443\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.key\\\"\\n          validation_context:\\n            trusted_ca:\\n              filename: \\\"/etc/secrets/das-wsi-qa-ma.fdsqapci.a.intuit.com.crt\\\"\\n            verify_certificate_spki: \\\"5fcSNapmJ5GJTeny4GXr+MTWSM+CaJ55Pbb7btDILyY=\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/wsi/\\\"\\n                route:\\n                  cluster: wsi\\n                  timeout: 300s\\n              - match:\\n                  prefix: \\\"/app-info\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 8002\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.key\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/health/full\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  clusters:\\n  - name: wsi\\n    connect_timeout: 0.25s\\n    type: strict_dns\\n    lb_policy: round_robin\\n    load_assignment:\\n      cluster_name: wsi\\n      endpoints:\\n      - lb_endpoints:\\n        - endpoint:\\n            address:\\n              socket_address:\\n                address: 127.0.0.1\\n                port_value: 8080\\nadmin:\\n  access_log_path: \\\"/dev/stdout\\\"\\n  address:\\n    socket_address:\\n      address: 0.0.0.0\\n      port_value: 8001\\n\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"data\\\":{\\\"envoy.yaml\\\":\\\"static_resources:\\\\n  listeners:\\\\n  - address:\\\\n      socket_address:\\\\n        address: 0.0.0.0\\\\n        port_value: 443\\\\n    filter_chains:\\\\n      tls_context:\\\\n        require_client_certificate: true\\\\n        common_tls_context:\\\\n          tls_certificates:\\\\n          - certificate_chain:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.crt\\\\\\\"\\\\n            private_key:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.key\\\\\\\"\\\\n          validation_context:\\\\n            trusted_ca:\\\\n              filename: \\\\\\\"/etc/secrets/das-wsi-qa-ma.fdsqapci.a.intuit.com.crt\\\\\\\"\\\\n            verify_certificate_spki: \\\\\\\"5fcSNapmJ5GJTeny4GXr+MTWSM+CaJ55Pbb7btDILyY=\\\\\\\"\\\\n      filters:\\\\n      - name: envoy.http_connection_manager\\\\n        typed_config:\\\\n          \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\\\n          codec_type: auto\\\\n          stat_prefix: ingress_http\\\\n          access_log:\\\\n            name: envoy.file_access_log\\\\n            typed_config:\\\\n              \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\\\n              path: \\\\\\\"/dev/stdout\\\\\\\"\\\\n          route_config:\\\\n            name: local_route\\\\n            virtual_hosts:\\\\n            - name: backend\\\\n              domains:\\\\n              - \\\\\\\"*\\\\\\\"\\\\n              routes:\\\\n              - match:\\\\n                  prefix: \\\\\\\"/wsi/\\\\\\\"\\\\n                route:\\\\n                  cluster: wsi\\\\n                  timeout: 300s\\\\n              - match:\\\\n                  prefix: \\\\\\\"/app-info\\\\\\\"\\\\n                route:\\\\n                  cluster: wsi\\\\n          http_filters:\\\\n          - name: envoy.router\\\\n            typed_config: {}\\\\n  - address:\\\\n      socket_address:\\\\n        address: 0.0.0.0\\\\n        port_value: 8002\\\\n    filter_chains:\\\\n      tls_context:\\\\n        require_client_certificate: true\\\\n        common_tls_context:\\\\n          tls_certificates:\\\\n          - certificate_chain:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.crt\\\\\\\"\\\\n            private_key:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsqapci.a.intuit.com.key\\\\\\\"\\\\n      filters:\\\\n      - name: envoy.http_connection_manager\\\\n        typed_config:\\\\n          \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\\\n          codec_type: auto\\\\n          stat_prefix: ingress_http\\\\n          access_log:\\\\n            name: envoy.file_access_log\\\\n            typed_config:\\\\n              \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\\\n              path: \\\\\\\"/dev/stdout\\\\\\\"\\\\n          route_config:\\\\n            name: local_route\\\\n            virtual_hosts:\\\\n            - name: backend\\\\n              domains:\\\\n              - \\\\\\\"*\\\\\\\"\\\\n              routes:\\\\n              - match:\\\\n                  prefix: \\\\\\\"/health/full\\\\\\\"\\\\n                route:\\\\n                  cluster: wsi\\\\n          http_filters:\\\\n          - name: envoy.router\\\\n            typed_config: {}\\\\n  clusters:\\\\n  - name: wsi\\\\n    connect_timeout: 0.25s\\\\n    type: strict_dns\\\\n    lb_policy: round_robin\\\\n    load_assignment:\\\\n      cluster_name: wsi\\\\n      endpoints:\\\\n      - lb_endpoints:\\\\n        - endpoint:\\\\n            address:\\\\n              socket_address:\\\\n                address: 127.0.0.1\\\\n                port_value: 8080\\\\nadmin:\\\\n  access_log_path: \\\\\\\"/dev/stdout\\\\\\\"\\\\n  address:\\\\n    socket_address:\\\\n      address: 0.0.0.0\\\\n      port_value: 8001\\\\n\\\\n\\\"},\\\"kind\\\":\\\"ConfigMap\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"name\\\":\\\"envoy-config\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"}}\\n\"},\"creationTimestamp\":\"2019-03-25T16:28:35Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"envoy-config\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"141570166\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/configmaps/envoy-config\",\"uid\":\"09d349d8-4f1b-11e9-b0b7-0ad032662b96\"}}"},{"kind":"PersistentVolumeClaim","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"web-service-integration-efs-pvc","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"PersistentVolumeClaim\",\"metadata\":{\"annotations\":{\"volume.beta.kubernetes.io/storage-class\":\"aws-efs\"},\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"web-service-integration-efs-pvc\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"accessModes\":[\"ReadWriteMany\"],\"resources\":{\"requests\":{\"storage\":\"1Mi\"}}}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"PersistentVolumeClaim\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"PersistentVolumeClaim\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"volume.beta.kubernetes.io/storage-class\\\":\\\"aws-efs\\\"},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"name\\\":\\\"web-service-integration-efs-pvc\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"accessModes\\\":[\\\"ReadWriteMany\\\"],\\\"resources\\\":{\\\"requests\\\":{\\\"storage\\\":\\\"1Mi\\\"}}}}\\n\",\"pv.kubernetes.io/bind-completed\":\"yes\",\"pv.kubernetes.io/bound-by-controller\":\"yes\",\"volume.beta.kubernetes.io/storage-class\":\"aws-efs\",\"volume.beta.kubernetes.io/storage-provisioner\":\"intuit.com/aws-efs\"},\"creationTimestamp\":\"2019-06-06T00:45:05Z\",\"finalizers\":[\"kubernetes.io/pvc-protection\"],\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"web-service-integration-efs-pvc\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"141570171\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/persistentvolumeclaims/web-service-integration-efs-pvc\",\"uid\":\"536697c2-87f4-11e9-a5fb-06f293a6fa06\"},\"spec\":{\"accessModes\":[\"ReadWriteMany\"],\"dataSource\":null,\"resources\":{\"requests\":{\"storage\":\"1Mi\"}},\"volumeMode\":\"Filesystem\",\"volumeName\":\"pvc-536697c2-87f4-11e9-a5fb-06f293a6fa06\"},\"status\":{\"accessModes\":[\"ReadWriteMany\"],\"capacity\":{\"storage\":\"1Mi\"},\"phase\":\"Bound\"}}"},{"kind":"Service","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"active-web-service-integration","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prf-web-service-integration.ifdp-preprod-west2.a.intuit.com\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"active-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"loadBalancerSourceRanges\":[\"34.209.187.205/32\",\"54.68.157.188/32\",\"35.162.109.211/32\",\"35.162.109.0/24\",\"65.204.229.0/24\",\"206.108.45.0/26\",\"199.16.139.0/26\",\"206.225.192.0/19\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"207.207.160.0/19\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.213.146.52/32\",\"35.167.249.16/32\",\"34.208.75.211/32\",\"52.34.159.199/32\",\"52.88.138.180/32\"],\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\"},\"type\":\"LoadBalancer\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prf-web-service-integration.ifdp-preprod-west2.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"fdp-connectivity-prf-web-service-integration.ifdp-preprod-west2.a.intuit.com\\\",\\\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\\\":\\\"300\\\"},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"name\\\":\\\"active-web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"loadBalancerSourceRanges\\\":[\\\"34.209.187.205/32\\\",\\\"54.68.157.188/32\\\",\\\"35.162.109.211/32\\\",\\\"35.162.109.0/24\\\",\\\"65.204.229.0/24\\\",\\\"206.108.45.0/26\\\",\\\"199.16.139.0/26\\\",\\\"206.225.192.0/19\\\",\\\"34.210.22.100/32\\\",\\\"35.164.49.48/32\\\",\\\"34.216.217.14/32\\\",\\\"54.69.219.97/32\\\",\\\"34.217.160.218/32\\\",\\\"34.214.99.205/32\\\",\\\"34.216.116.138/32\\\",\\\"34.216.48.219/32\\\",\\\"173.240.160.0/21\\\",\\\"207.207.160.0/19\\\",\\\"199.16.136.0/21\\\",\\\"54.68.157.0/24\\\",\\\"35.162.109.211/32\\\",\\\"54.68.157.188/32\\\",\\\"34.213.146.52/32\\\",\\\"35.167.249.16/32\\\",\\\"34.208.75.211/32\\\",\\\"52.34.159.199/32\\\",\\\"52.88.138.180/32\\\"],\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":443}],\\\"selector\\\":{\\\"app\\\":\\\"web-service-integration\\\"},\\\"type\\\":\\\"LoadBalancer\\\"}}\\n\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"creationTimestamp\":\"2019-05-15T18:22:23Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"active-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"145697815\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/services/active-web-service-integration\",\"uid\":\"62363116-773e-11e9-a012-06dc4768c06c\"},\"spec\":{\"clusterIP\":\"100.70.252.141\",\"externalTrafficPolicy\":\"Cluster\",\"loadBalancerSourceRanges\":[\"34.209.187.205/32\",\"54.68.157.188/32\",\"35.162.109.211/32\",\"35.162.109.0/24\",\"65.204.229.0/24\",\"206.108.45.0/26\",\"199.16.139.0/26\",\"206.225.192.0/19\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"207.207.160.0/19\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.213.146.52/32\",\"35.167.249.16/32\",\"34.208.75.211/32\",\"52.34.159.199/32\",\"52.88.138.180/32\"],\"ports\":[{\"name\":\"service\",\"nodePort\":32569,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\",\"rollouts-pod-template-hash\":\"6758574447\"},\"sessionAffinity\":\"None\",\"type\":\"LoadBalancer\"},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"a62363116773e11e9a01206dc4768c06-1443576796.us-west-2.elb.amazonaws.com\"}]}}}"},{"kind":"Service","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"preview-web-service-integration","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prf-web-service-integration-preview.ifdp-preprod-west2.a.intuit.com\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"preview-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"loadBalancerSourceRanges\":[\"34.209.187.205/32\",\"54.68.157.188/32\",\"35.162.109.211/32\",\"35.162.109.0/24\",\"65.204.229.0/24\",\"206.108.45.0/26\",\"199.16.139.0/26\",\"206.225.192.0/19\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"207.207.160.0/19\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.213.146.52/32\",\"35.167.249.16/32\",\"34.208.75.211/32\",\"52.34.159.199/32\",\"52.88.138.180/32\"],\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\"},\"type\":\"LoadBalancer\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prf-web-service-integration-preview.ifdp-preprod-west2.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"fdp-connectivity-prf-web-service-integration-preview.ifdp-preprod-west2.a.intuit.com\\\",\\\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\\\":\\\"300\\\"},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"name\\\":\\\"preview-web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"loadBalancerSourceRanges\\\":[\\\"34.209.187.205/32\\\",\\\"54.68.157.188/32\\\",\\\"35.162.109.211/32\\\",\\\"35.162.109.0/24\\\",\\\"65.204.229.0/24\\\",\\\"206.108.45.0/26\\\",\\\"199.16.139.0/26\\\",\\\"206.225.192.0/19\\\",\\\"34.210.22.100/32\\\",\\\"35.164.49.48/32\\\",\\\"34.216.217.14/32\\\",\\\"54.69.219.97/32\\\",\\\"34.217.160.218/32\\\",\\\"34.214.99.205/32\\\",\\\"34.216.116.138/32\\\",\\\"34.216.48.219/32\\\",\\\"173.240.160.0/21\\\",\\\"207.207.160.0/19\\\",\\\"199.16.136.0/21\\\",\\\"54.68.157.0/24\\\",\\\"35.162.109.211/32\\\",\\\"54.68.157.188/32\\\",\\\"34.213.146.52/32\\\",\\\"35.167.249.16/32\\\",\\\"34.208.75.211/32\\\",\\\"52.34.159.199/32\\\",\\\"52.88.138.180/32\\\"],\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":443}],\\\"selector\\\":{\\\"app\\\":\\\"web-service-integration\\\"},\\\"type\\\":\\\"LoadBalancer\\\"}}\\n\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"creationTimestamp\":\"2019-05-15T18:22:23Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"name\":\"preview-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"145697855\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/services/preview-web-service-integration\",\"uid\":\"62334249-773e-11e9-9427-0a985b86565a\"},\"spec\":{\"clusterIP\":\"100.65.58.40\",\"externalTrafficPolicy\":\"Cluster\",\"loadBalancerSourceRanges\":[\"34.209.187.205/32\",\"54.68.157.188/32\",\"35.162.109.211/32\",\"35.162.109.0/24\",\"65.204.229.0/24\",\"206.108.45.0/26\",\"199.16.139.0/26\",\"206.225.192.0/19\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"207.207.160.0/19\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.213.146.52/32\",\"35.167.249.16/32\",\"34.208.75.211/32\",\"52.34.159.199/32\",\"52.88.138.180/32\"],\"ports\":[{\"name\":\"service\",\"nodePort\":32483,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\",\"rollouts-pod-template-hash\":\"\"},\"sessionAffinity\":\"None\",\"type\":\"LoadBalancer\"},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"a62334249773e11e994270a985b86565-1283295631.us-west-2.elb.amazonaws.com\"}]}}}"},{"kind":"Service","namespace":"fdp-connectivity-web-service-integration-usw2-ppd-prf","name":"web-service-integration-metrics","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"web-service-integration-metrics\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\"},\"spec\":{\"ports\":[{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"web-service-integration\"}}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"web-service-integration-metrics\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-ppd-prf\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"web-service-integration\\\"}}}\\n\"},\"creationTimestamp\":\"2019-06-21T20:22:53Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"web-service-integration-metrics\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-ppd-prf\",\"resourceVersion\":\"145541197\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-ppd-prf/services/web-service-integration-metrics\",\"uid\":\"59455271-9462-11e9-9b97-0675512824ee\"},\"spec\":{\"clusterIP\":\"100.67.61.156\",\"ports\":[{\"name\":\"iks-metric\",\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"web-service-integration\"},\"sessionAffinity\":\"None\",\"type\":\"ClusterIP\"},\"status\":{\"loadBalancer\":{}}}"}]}`

//Test HPA and noReplicas applied
func TestRolloutWithNoReplicas(t *testing.T) {
	diffs := toResourceDiffs(t, rolloutWithNoReplicas)
	_, names, deploys, result := verifyHpa(diffs)
	assert.EqualValues(t, result, 0)

	applyLastAppliedConfigPatch(nil, nil, "fdp-connectivity-web-service-integration-usw2-ppd-prf", names, deploys, true)
}

const rolloutWithReplicas = `
{"items":[{"kind":"Service","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"active-web-service-integration","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prd-web-service-integration.ifdp-prod-pci-usw2.iks.a.intuit.com\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"active-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"loadBalancerSourceRanges\":[\"35.162.109.0/24\",\"34.211.159.228/32\",\"34.212.57.212/32\",\"52.24.96.248/32\",\"65.204.229.0/24\",\"199.16.139.0/26\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.209.187.205/32\",\"35.167.249.16/32\"],\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\"},\"type\":\"LoadBalancer\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prd-web-service-integration.ifdp-prod-pci-usw2.iks.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"fdp-connectivity-prd-web-service-integration.ifdp-prod-pci-usw2.iks.a.intuit.com\\\",\\\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\\\":\\\"300\\\"},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"name\\\":\\\"active-web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"spec\\\":{\\\"loadBalancerSourceRanges\\\":[\\\"35.162.109.0/24\\\",\\\"34.211.159.228/32\\\",\\\"34.212.57.212/32\\\",\\\"52.24.96.248/32\\\",\\\"65.204.229.0/24\\\",\\\"199.16.139.0/26\\\",\\\"34.210.22.100/32\\\",\\\"35.164.49.48/32\\\",\\\"34.216.217.14/32\\\",\\\"54.69.219.97/32\\\",\\\"34.217.160.218/32\\\",\\\"34.214.99.205/32\\\",\\\"34.216.116.138/32\\\",\\\"34.216.48.219/32\\\",\\\"173.240.160.0/21\\\",\\\"199.16.136.0/21\\\",\\\"54.68.157.0/24\\\",\\\"35.162.109.211/32\\\",\\\"35.162.109.211/32\\\",\\\"54.68.157.188/32\\\",\\\"34.209.187.205/32\\\",\\\"35.167.249.16/32\\\"],\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":443}],\\\"selector\\\":{\\\"app\\\":\\\"web-service-integration\\\"},\\\"type\\\":\\\"LoadBalancer\\\"}}\\n\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"creationTimestamp\":\"2019-05-15T19:26:41Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"active-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"45585278\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/services/active-web-service-integration\",\"uid\":\"5dc1153e-7747-11e9-8638-06b1fc9bd508\"},\"spec\":{\"clusterIP\":\"100.69.229.246\",\"externalTrafficPolicy\":\"Cluster\",\"loadBalancerSourceRanges\":[\"35.162.109.0/24\",\"34.211.159.228/32\",\"34.212.57.212/32\",\"52.24.96.248/32\",\"65.204.229.0/24\",\"199.16.139.0/26\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.209.187.205/32\",\"35.167.249.16/32\"],\"ports\":[{\"name\":\"service\",\"nodePort\":32514,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\",\"rollouts-pod-template-hash\":\"6d99444d55\"},\"sessionAffinity\":\"None\",\"type\":\"LoadBalancer\"},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"a5dc1153e774711e9863806b1fc9bd50-876744896.us-west-2.elb.amazonaws.com\"}]}}}"},{"kind":"Service","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"preview-web-service-integration","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prd-web-service-integration-preview.ifdp-prod-pci-usw2.iks.a.intuit.com\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"preview-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"loadBalancerSourceRanges\":[\"35.162.109.0/24\",\"34.211.159.228/32\",\"34.212.57.212/32\",\"52.24.96.248/32\",\"65.204.229.0/24\",\"199.16.139.0/26\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.209.187.205/32\",\"35.167.249.16/32\"],\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\"},\"type\":\"LoadBalancer\"}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"external-dns.alpha.kubernetes.io/hostname\":\"fdp-connectivity-prd-web-service-integration-preview.ifdp-prod-pci-usw2.iks.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"fdp-connectivity-prd-web-service-integration-preview.ifdp-prod-pci-usw2.iks.a.intuit.com\\\",\\\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\\\":\\\"300\\\"},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"name\\\":\\\"preview-web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"spec\\\":{\\\"loadBalancerSourceRanges\\\":[\\\"35.162.109.0/24\\\",\\\"34.211.159.228/32\\\",\\\"34.212.57.212/32\\\",\\\"52.24.96.248/32\\\",\\\"65.204.229.0/24\\\",\\\"199.16.139.0/26\\\",\\\"34.210.22.100/32\\\",\\\"35.164.49.48/32\\\",\\\"34.216.217.14/32\\\",\\\"54.69.219.97/32\\\",\\\"34.217.160.218/32\\\",\\\"34.214.99.205/32\\\",\\\"34.216.116.138/32\\\",\\\"34.216.48.219/32\\\",\\\"173.240.160.0/21\\\",\\\"199.16.136.0/21\\\",\\\"54.68.157.0/24\\\",\\\"35.162.109.211/32\\\",\\\"35.162.109.211/32\\\",\\\"54.68.157.188/32\\\",\\\"34.209.187.205/32\\\",\\\"35.167.249.16/32\\\"],\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":443}],\\\"selector\\\":{\\\"app\\\":\\\"web-service-integration\\\"},\\\"type\\\":\\\"LoadBalancer\\\"}}\\n\",\"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout\":\"300\"},\"creationTimestamp\":\"2019-05-15T19:26:40Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"preview-web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"45585288\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/services/preview-web-service-integration\",\"uid\":\"5db39ca7-7747-11e9-885f-0a60f2d05710\"},\"spec\":{\"clusterIP\":\"100.69.132.52\",\"externalTrafficPolicy\":\"Cluster\",\"loadBalancerSourceRanges\":[\"35.162.109.0/24\",\"34.211.159.228/32\",\"34.212.57.212/32\",\"52.24.96.248/32\",\"65.204.229.0/24\",\"199.16.139.0/26\",\"34.210.22.100/32\",\"35.164.49.48/32\",\"34.216.217.14/32\",\"54.69.219.97/32\",\"34.217.160.218/32\",\"34.214.99.205/32\",\"34.216.116.138/32\",\"34.216.48.219/32\",\"173.240.160.0/21\",\"199.16.136.0/21\",\"54.68.157.0/24\",\"35.162.109.211/32\",\"35.162.109.211/32\",\"54.68.157.188/32\",\"34.209.187.205/32\",\"35.167.249.16/32\"],\"ports\":[{\"name\":\"service\",\"nodePort\":30238,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":443}],\"selector\":{\"app\":\"web-service-integration\",\"rollouts-pod-template-hash\":\"\"},\"sessionAffinity\":\"None\",\"type\":\"LoadBalancer\"},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"a5db39ca7774711e9885f0a60f2d0571-862837331.us-west-2.elb.amazonaws.com\"}]}}}"},{"kind":"Service","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"web-service-integration-metrics","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"web-service-integration-metrics\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"ports\":[{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"web-service-integration\"}}}","liveState":"null","diff":"{\n  \"apiVersion\": [\n    \"v1\"\n  ],\n  \"kind\": [\n    \"Service\"\n  ],\n  \"metadata\": [\n    {\n      \"labels\": {\n        \"applications.argoproj.io/app-name\": \"fdp-connectivity-web-service-integration-usw2-prd-prd\",\n        \"iks-metric\": \"actuator-prometheus\"\n      },\n      \"name\": \"web-service-integration-metrics\"\n    }\n  ],\n  \"spec\": [\n    {\n      \"ports\": [\n        {\n          \"name\": \"iks-metric\",\n          \"port\": 8490,\n          \"targetPort\": 8490\n        }\n      ],\n      \"selector\": {\n        \"app\": \"web-service-integration\"\n      }\n    }\n  ]\n}\n"},{"group":"batch","kind":"CronJob","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"web-service-integration-cgds-transfer","targetState":"{\"apiVersion\":\"batch/v1beta1\",\"kind\":\"CronJob\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration-cgds-transfer\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"concurrencyPolicy\":\"Forbid\",\"failedJobsHistoryLimit\":2,\"jobTemplate\":{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\",\"splunk-sourcetype\":\"{\\\"web-service-integration\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"}}\"},\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"assetId\":\"5766876915036502990\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"wsi\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"wsi_env\",\"value\":\"prd\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-cgds:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-663-eb834c9\",\"name\":\"web-service-integration-cgds-transfer\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-6b7athiqaksu\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"OnFailure\",\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}},\"schedule\":\"10,40 * * * *\",\"successfulJobsHistoryLimit\":2}}","liveState":"{\"apiVersion\":\"batch/v1beta1\",\"kind\":\"CronJob\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"batch/v1beta1\\\",\\\"kind\\\":\\\"CronJob\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"prd\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\"},\\\"name\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"spec\\\":{\\\"concurrencyPolicy\\\":\\\"Forbid\\\",\\\"failedJobsHistoryLimit\\\":2,\\\"jobTemplate\\\":{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\\\",\\\"splunk-sourcetype\\\":\\\"{\\\\\\\"web-service-integration\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsi\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsi\\\\\\\"}}\\\"},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"env\\\":\\\"prd\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\",\\\"splunk-index\\\":\\\"wsi\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"wsi_env\\\",\\\"value\\\":\\\"prd\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-cgds:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-663-eb834c9\\\",\\\"name\\\":\\\"web-service-integration-cgds-transfer\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"256M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"256M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"},{\\\"mountPath\\\":\\\"/cgds\\\",\\\"name\\\":\\\"wsiefs\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-6b7athiqaksu\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-f\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS_CERT\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-cert\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"restartPolicy\\\":\\\"OnFailure\\\",\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"},{\\\"name\\\":\\\"wsiefs\\\",\\\"persistentVolumeClaim\\\":{\\\"claimName\\\":\\\"web-service-integration-efs-pvc\\\"}}]}}}},\\\"schedule\\\":\\\"10,40 * * * *\\\",\\\"successfulJobsHistoryLimit\\\":2}}\\n\"},\"creationTimestamp\":\"2019-06-06T16:35:47Z\",\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration-cgds-transfer\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"46978358\",\"selfLink\":\"/apis/batch/v1beta1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/cronjobs/web-service-integration-cgds-transfer\",\"uid\":\"2349aa0b-8879-11e9-b7bd-0a68ee686a60\"},\"spec\":{\"concurrencyPolicy\":\"Forbid\",\"failedJobsHistoryLimit\":2,\"jobTemplate\":{\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\",\"splunk-sourcetype\":\"{\\\"web-service-integration\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"}}\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"web-service-integration-cgds-transfer\",\"assetId\":\"5766876915036502990\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"wsi\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"wsi_env\",\"value\":\"prd\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-cgds:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-663-eb834c9\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"web-service-integration-cgds-transfer\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"256M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"256M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-6b7athiqaksu\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"idpsloader-cert\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"OnFailure\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}},\"schedule\":\"10,40 * * * *\",\"successfulJobsHistoryLimit\":2,\"suspend\":false},\"status\":{\"lastScheduleTime\":\"2019-06-22T00:10:00Z\"}}","diff":"{\n  \"spec\": {\n    \"jobTemplate\": {\n      \"spec\": {\n        \"template\": {\n          \"spec\": {\n            \"containers\": {\n              \"0\": {\n                \"resources\": {\n                  \"limits\": {\n                    \"memory\": [\n                      \"256M\",\n                      \"128M\"\n                    ]\n                  },\n                  \"requests\": {\n                    \"memory\": [\n                      \"256M\",\n                      \"128M\"\n                    ]\n                  }\n                }\n              },\n              \"_t\": \"a\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n"},{"group":"autoscaling","kind":"HorizontalPodAutoscaler","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"web-service-integration","targetState":"{\"apiVersion\":\"autoscaling/v2beta1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"maxReplicas\":20,\"metrics\":[{\"object\":{\"metricName\":\"namespace_app_pod_cpu_utilization\",\"target\":{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"name\":\"web-service-integration\"},\"targetValue\":\"30\"},\"type\":\"Object\"}],\"minReplicas\":9,\"scaleTargetRef\":{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"name\":\"web-service-integration\"}}}","liveState":"null","diff":"{\n  \"apiVersion\": [\n    \"autoscaling/v2beta1\"\n  ],\n  \"kind\": [\n    \"HorizontalPodAutoscaler\"\n  ],\n  \"metadata\": [\n    {\n      \"labels\": {\n        \"app\": \"web-service-integration\",\n        \"applications.argoproj.io/app-name\": \"fdp-connectivity-web-service-integration-usw2-prd-prd\"\n      },\n      \"name\": \"web-service-integration\"\n    }\n  ],\n  \"spec\": [\n    {\n      \"maxReplicas\": 20,\n      \"metrics\": [\n        {\n          \"object\": {\n            \"metricName\": \"namespace_app_pod_cpu_utilization\",\n            \"target\": {\n              \"apiVersion\": \"apps/v1beta2\",\n              \"kind\": \"Deployment\",\n              \"name\": \"web-service-integration\"\n            },\n            \"targetValue\": \"30\"\n          },\n          \"type\": \"Object\"\n        }\n      ],\n      \"minReplicas\": 9,\n      \"scaleTargetRef\": {\n        \"apiVersion\": \"argoproj.io/v1alpha1\",\n        \"kind\": \"Rollout\",\n        \"name\": \"web-service-integration\"\n      }\n    }\n  ]\n}\n"},{"group":"argoproj.io","kind":"Rollout","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"web-service-integration","targetState":"{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"revisionHistoryLimit\":3,\"selector\":{\"matchLabels\":{\"app\":\"web-service-integration\"}},\"strategy\":{\"blueGreen\":{\"activeService\":\"active-web-service-integration\",\"autoPromotionEnabled\":false,\"previewService\":\"preview-web-service-integration\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"HTTP\",\"prometheus.io/scrape\":\"true\",\"splunk-sourcetype\":\"{\\\"wsi-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"} , \\\"perflog-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsiperf\\\", \\\"stderr\\\": \\\"fdpwsiperf\\\"} , \\\"oil-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsioil\\\", \\\"stderr\\\": \\\"fdpwsioil\\\"}, \\\"cgds-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsicgds\\\", \\\"stderr\\\": \\\"fdpwsicgds\\\"}}\"},\"labels\":{\"app\":\"web-service-integration\",\"assetId\":\"5766876915036502990\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"wsi\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"APP_ENV_PROPERTIES\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"L1\",\"value\":\"fdp\"},{\"name\":\"L2\",\"value\":\"connectivity\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app-iks\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-prod.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"web-service-integration\",\"ports\":[{\"containerPort\":8080,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"12G\"},\"requests\":{\"cpu\":\"2\",\"memory\":\"12G\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/usr/local/tomcat/logs/\",\"name\":\"varlog\"},{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice-perf.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"perflog-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsi-oil.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"oil-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"wsi-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/cgds\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"cgds-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"env\":[{\"name\":\"IDPS_APPLIANCE_URL\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"SEC_TOOLS_SECRETS_ROOT_DIR\",\"value\":\"/secrets/sigsci-agent\"}],\"image\":\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\",\"name\":\"sigsci-agent-container\",\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"}]},{\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"envoy-proxy\",\"ports\":[{\"containerPort\":443,\"name\":\"envoy-service\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"1500M\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"1500M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/envoy\",\"name\":\"envoy-config\",\"readOnly\":true},{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-6b7athiqaksu\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-l\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/application_secrets.properties\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-secrets\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"configMap\":{\"items\":[{\"key\":\"envoy.yaml\",\"path\":\"envoy.yaml\"}],\"name\":\"envoy-config\"},\"name\":\"envoy-config\"},{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"emptyDir\":{},\"name\":\"varlog\"},{\"emptyDir\":{},\"name\":\"sigscisharedvolume\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}}","liveState":"{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"argoproj.io/v1alpha1\\\",\\\"kind\\\":\\\"Rollout\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"prd\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\"},\\\"name\\\":\\\"web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"spec\\\":{\\\"replicas\\\":9,\\\"revisionHistoryLimit\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"web-service-integration\\\"}},\\\"strategy\\\":{\\\"blueGreen\\\":{\\\"activeService\\\":\\\"active-web-service-integration\\\",\\\"previewService\\\":\\\"preview-web-service-integration\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"HTTP\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\",\\\"splunk-sourcetype\\\":\\\"{\\\\\\\"wsi-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsi\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsi\\\\\\\"} , \\\\\\\"perflog-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsiperf\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsiperf\\\\\\\"} , \\\\\\\"oil-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsioil\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsioil\\\\\\\"}, \\\\\\\"cgds-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsicgds\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsicgds\\\\\\\"}}\\\"},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"env\\\":\\\"prd\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\",\\\"splunk-index\\\":\\\"wsi\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"APP_ENV_PROPERTIES\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"fdp\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"connectivity\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app-iks\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8080,\\\"scheme\\\":\\\"HTTP\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"web-service-integration\\\",\\\"ports\\\":[{\\\"containerPort\\\":8080,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8080,\\\"scheme\\\":\\\"HTTP\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"2\\\",\\\"memory\\\":\\\"10G\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"2\\\",\\\"memory\\\":\\\"10G\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"},{\\\"mountPath\\\":\\\"/usr/local/tomcat/logs/\\\",\\\"name\\\":\\\"varlog\\\"},{\\\"mountPath\\\":\\\"/var/run/sigsci\\\",\\\"name\\\":\\\"sigscisharedvolume\\\"},{\\\"mountPath\\\":\\\"/cgds\\\",\\\"name\\\":\\\"wsiefs\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsiservice-perf.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"perflog-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsi-oil.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"oil-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsiservice.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"wsi-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/cgds\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"cgds-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"env\\\":[{\\\"name\\\":\\\"IDPS_APPLIANCE_URL\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"SEC_TOOLS_SECRETS_ROOT_DIR\\\",\\\"value\\\":\\\"/secrets/sigsci-agent\\\"}],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\\\",\\\"name\\\":\\\"sigsci-agent-container\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"512Mi\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"512Mi\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/run/sigsci\\\",\\\"name\\\":\\\"sigscisharedvolume\\\"}]},{\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8002,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"envoy-proxy\\\",\\\"ports\\\":[{\\\"containerPort\\\":443,\\\"name\\\":\\\"envoy-service\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8002,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"500m\\\",\\\"memory\\\":\\\"1024M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"500m\\\",\\\"memory\\\":\\\"1024M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/envoy\\\",\\\"name\\\":\\\"envoy-config\\\",\\\"readOnly\\\":true},{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-6b7athiqaksu\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-l\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/application_secrets.properties\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-secrets\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-f\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS_CERT\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-cert\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"configMap\\\":{\\\"items\\\":[{\\\"key\\\":\\\"envoy.yaml\\\",\\\"path\\\":\\\"envoy.yaml\\\"}],\\\"name\\\":\\\"envoy-config\\\"},\\\"name\\\":\\\"envoy-config\\\"},{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"},{\\\"emptyDir\\\":{},\\\"name\\\":\\\"varlog\\\"},{\\\"emptyDir\\\":{},\\\"name\\\":\\\"sigscisharedvolume\\\"},{\\\"name\\\":\\\"wsiefs\\\",\\\"persistentVolumeClaim\\\":{\\\"claimName\\\":\\\"web-service-integration-efs-pvc\\\"}}]}}}}\\n\",\"rollout.argoproj.io/revision\":\"20\"},\"creationTimestamp\":\"2019-05-15T19:26:41Z\",\"generation\":393,\"labels\":{\"app\":\"web-service-integration\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"46391608\",\"selfLink\":\"/apis/argoproj.io/v1alpha1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/rollouts/web-service-integration\",\"uid\":\"5def8381-7747-11e9-88f6-029fb774bb1c\"},\"spec\":{\"minReadySeconds\":0,\"paused\":false,\"replicas\":9,\"revisionHistoryLimit\":3,\"selector\":{\"matchLabels\":{\"app\":\"web-service-integration\"}},\"strategy\":{\"blueGreen\":{\"activeService\":\"active-web-service-integration\",\"previewService\":\"preview-web-service-integration\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"HTTP\",\"prometheus.io/scrape\":\"true\",\"splunk-sourcetype\":\"{\\\"wsi-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"} , \\\"perflog-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsiperf\\\", \\\"stderr\\\": \\\"fdpwsiperf\\\"} , \\\"oil-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsioil\\\", \\\"stderr\\\": \\\"fdpwsioil\\\"}, \\\"cgds-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsicgds\\\", \\\"stderr\\\": \\\"fdpwsicgds\\\"}}\"},\"labels\":{\"app\":\"web-service-integration\",\"assetId\":\"5766876915036502990\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"wsi\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"APP_ENV_PROPERTIES\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"L1\",\"value\":\"fdp\"},{\"name\":\"L2\",\"value\":\"connectivity\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app-iks\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-prod.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"web-service-integration\",\"ports\":[{\"containerPort\":8080,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"10G\"},\"requests\":{\"cpu\":\"2\",\"memory\":\"10G\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/usr/local/tomcat/logs/\",\"name\":\"varlog\"},{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice-perf.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"perflog-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsi-oil.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"oil-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"wsi-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/cgds\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"cgds-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"env\":[{\"name\":\"IDPS_APPLIANCE_URL\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"SEC_TOOLS_SECRETS_ROOT_DIR\",\"value\":\"/secrets/sigsci-agent\"}],\"image\":\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\",\"name\":\"sigsci-agent-container\",\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"512Mi\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"512Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"}]},{\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"envoy-proxy\",\"ports\":[{\"containerPort\":443,\"name\":\"envoy-service\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"1024M\"},\"requests\":{\"cpu\":\"500m\",\"memory\":\"1024M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/envoy\",\"name\":\"envoy-config\",\"readOnly\":true},{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-6b7athiqaksu\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"resources\":{},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-l\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/application_secrets.properties\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-secrets\",\"resources\":{},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"resources\":{},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"configMap\":{\"items\":[{\"key\":\"envoy.yaml\",\"path\":\"envoy.yaml\"}],\"name\":\"envoy-config\"},\"name\":\"envoy-config\"},{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"emptyDir\":{},\"name\":\"varlog\"},{\"emptyDir\":{},\"name\":\"sigscisharedvolume\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}},\"status\":{\"HPAReplicas\":9,\"availableReplicas\":9,\"blueGreen\":{\"activeSelector\":\"6d99444d55\"},\"canary\":{},\"conditions\":[{\"lastTransitionTime\":\"2019-06-20T01:11:49Z\",\"lastUpdateTime\":\"2019-06-20T01:11:49Z\",\"message\":\"ReplicaSet \\\"web-service-integration-6d99444d55\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-21T02:48:17Z\",\"lastUpdateTime\":\"2019-06-21T02:48:17Z\",\"message\":\"Rollout has minimum availability\",\"reason\":\"AvailableReason\",\"status\":\"True\",\"type\":\"Available\"}],\"currentPodHash\":\"6d99444d55\",\"observedGeneration\":\"865fd7fd8\",\"readyReplicas\":9,\"replicas\":9,\"selector\":\"app=web-service-integration,rollouts-pod-template-hash=6d99444d55\",\"updatedReplicas\":9}}","diff":"{\n  \"spec\": {\n    \"strategy\": {\n      \"blueGreen\": {\n        \"autoPromotionEnabled\": [\n          false\n        ]\n      }\n    },\n    \"template\": {\n      \"spec\": {\n        \"containers\": {\n          \"0\": {\n            \"resources\": {\n              \"limits\": {\n                \"memory\": [\n                  \"10G\",\n                  \"12G\"\n                ]\n              },\n              \"requests\": {\n                \"memory\": [\n                  \"10G\",\n                  \"12G\"\n                ]\n              }\n            }\n          },\n          \"1\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"2\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"3\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"4\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"5\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"1\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"512Mi\",\n                  \"400Mi\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"1\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"512Mi\",\n                  \"400Mi\"\n                ]\n              }\n            }\n          },\n          \"6\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"500m\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"1024M\",\n                  \"1500M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"500m\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"1024M\",\n                  \"1500M\"\n                ]\n              }\n            }\n          },\n          \"_t\": \"a\"\n        }\n      }\n    }\n  }\n}\n"},{"kind":"ConfigMap","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"envoy-config","targetState":"{\"apiVersion\":\"v1\",\"data\":{\"envoy.yaml\":\"static_resources:\\n  listeners:\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 443\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.key\\\"\\n          validation_context:\\n            trusted_ca:\\n              filename: \\\"/etc/secrets/das-wsi-prod-ma.fdsprodpci.a.intuit.com.crt\\\"\\n            verify_certificate_spki: \\\"UA51VJlZaSUlr0IViPZXE3MxPgx9ch+BHCmlCNuiMTc=\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/wsi/\\\"\\n                route:\\n                  cluster: wsi\\n                  timeout: 300s\\n              - match:\\n                  prefix: \\\"/app-info\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 8002\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.key\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/health/full\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  clusters:\\n  - name: wsi\\n    connect_timeout: 0.25s\\n    type: strict_dns\\n    lb_policy: round_robin\\n    load_assignment:\\n      cluster_name: wsi\\n      endpoints:\\n      - lb_endpoints:\\n        - endpoint:\\n            address:\\n              socket_address:\\n                address: 127.0.0.1\\n                port_value: 8080\\nadmin:\\n  access_log_path: \\\"/dev/stdout\\\"\\n  address:\\n    socket_address:\\n      address: 0.0.0.0\\n      port_value: 8001\\n\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"envoy-config\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"}}","liveState":"{\"apiVersion\":\"v1\",\"data\":{\"envoy.yaml\":\"static_resources:\\n  listeners:\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 443\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.key\\\"\\n          validation_context:\\n            trusted_ca:\\n              filename: \\\"/etc/secrets/das-wsi-prod-ma.fdsprodpci.a.intuit.com.crt\\\"\\n            verify_certificate_spki: \\\"UA51VJlZaSUlr0IViPZXE3MxPgx9ch+BHCmlCNuiMTc=\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/wsi/\\\"\\n                route:\\n                  cluster: wsi\\n                  timeout: 300s\\n              - match:\\n                  prefix: \\\"/app-info\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  - address:\\n      socket_address:\\n        address: 0.0.0.0\\n        port_value: 8002\\n    filter_chains:\\n      tls_context:\\n        require_client_certificate: true\\n        common_tls_context:\\n          tls_certificates:\\n          - certificate_chain:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.crt\\\"\\n            private_key:\\n              filename: \\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.key\\\"\\n      filters:\\n      - name: envoy.http_connection_manager\\n        typed_config:\\n          \\\"@type\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\n          codec_type: auto\\n          stat_prefix: ingress_http\\n          access_log:\\n            name: envoy.file_access_log\\n            typed_config:\\n              \\\"@type\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\n              path: \\\"/dev/stdout\\\"\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: backend\\n              domains:\\n              - \\\"*\\\"\\n              routes:\\n              - match:\\n                  prefix: \\\"/health/full\\\"\\n                route:\\n                  cluster: wsi\\n          http_filters:\\n          - name: envoy.router\\n            typed_config: {}\\n  clusters:\\n  - name: wsi\\n    connect_timeout: 0.25s\\n    type: strict_dns\\n    lb_policy: round_robin\\n    load_assignment:\\n      cluster_name: wsi\\n      endpoints:\\n      - lb_endpoints:\\n        - endpoint:\\n            address:\\n              socket_address:\\n                address: 127.0.0.1\\n                port_value: 8080\\nadmin:\\n  access_log_path: \\\"/dev/stdout\\\"\\n  address:\\n    socket_address:\\n      address: 0.0.0.0\\n      port_value: 8001\\n\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"data\\\":{\\\"envoy.yaml\\\":\\\"static_resources:\\\\n  listeners:\\\\n  - address:\\\\n      socket_address:\\\\n        address: 0.0.0.0\\\\n        port_value: 443\\\\n    filter_chains:\\\\n      tls_context:\\\\n        require_client_certificate: true\\\\n        common_tls_context:\\\\n          tls_certificates:\\\\n          - certificate_chain:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.crt\\\\\\\"\\\\n            private_key:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.key\\\\\\\"\\\\n          validation_context:\\\\n            trusted_ca:\\\\n              filename: \\\\\\\"/etc/secrets/das-wsi-prod-ma.fdsprodpci.a.intuit.com.crt\\\\\\\"\\\\n            verify_certificate_spki: \\\\\\\"UA51VJlZaSUlr0IViPZXE3MxPgx9ch+BHCmlCNuiMTc=\\\\\\\"\\\\n      filters:\\\\n      - name: envoy.http_connection_manager\\\\n        typed_config:\\\\n          \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\\\n          codec_type: auto\\\\n          stat_prefix: ingress_http\\\\n          access_log:\\\\n            name: envoy.file_access_log\\\\n            typed_config:\\\\n              \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\\\n              path: \\\\\\\"/dev/stdout\\\\\\\"\\\\n          route_config:\\\\n            name: local_route\\\\n            virtual_hosts:\\\\n            - name: backend\\\\n              domains:\\\\n              - \\\\\\\"*\\\\\\\"\\\\n              routes:\\\\n              - match:\\\\n                  prefix: \\\\\\\"/wsi/\\\\\\\"\\\\n                route:\\\\n                  cluster: wsi\\\\n                  timeout: 300s\\\\n              - match:\\\\n                  prefix: \\\\\\\"/app-info\\\\\\\"\\\\n                route:\\\\n                  cluster: wsi\\\\n          http_filters:\\\\n          - name: envoy.router\\\\n            typed_config: {}\\\\n  - address:\\\\n      socket_address:\\\\n        address: 0.0.0.0\\\\n        port_value: 8002\\\\n    filter_chains:\\\\n      tls_context:\\\\n        require_client_certificate: true\\\\n        common_tls_context:\\\\n          tls_certificates:\\\\n          - certificate_chain:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.crt\\\\\\\"\\\\n            private_key:\\\\n              filename: \\\\\\\"/etc/secrets/ikswildcard.fdsprdpci.a.intuit.com.key\\\\\\\"\\\\n      filters:\\\\n      - name: envoy.http_connection_manager\\\\n        typed_config:\\\\n          \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager\\\\n          codec_type: auto\\\\n          stat_prefix: ingress_http\\\\n          access_log:\\\\n            name: envoy.file_access_log\\\\n            typed_config:\\\\n              \\\\\\\"@type\\\\\\\": type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog\\\\n              path: \\\\\\\"/dev/stdout\\\\\\\"\\\\n          route_config:\\\\n            name: local_route\\\\n            virtual_hosts:\\\\n            - name: backend\\\\n              domains:\\\\n              - \\\\\\\"*\\\\\\\"\\\\n              routes:\\\\n              - match:\\\\n                  prefix: \\\\\\\"/health/full\\\\\\\"\\\\n                route:\\\\n                  cluster: wsi\\\\n          http_filters:\\\\n          - name: envoy.router\\\\n            typed_config: {}\\\\n  clusters:\\\\n  - name: wsi\\\\n    connect_timeout: 0.25s\\\\n    type: strict_dns\\\\n    lb_policy: round_robin\\\\n    load_assignment:\\\\n      cluster_name: wsi\\\\n      endpoints:\\\\n      - lb_endpoints:\\\\n        - endpoint:\\\\n            address:\\\\n              socket_address:\\\\n                address: 127.0.0.1\\\\n                port_value: 8080\\\\nadmin:\\\\n  access_log_path: \\\\\\\"/dev/stdout\\\\\\\"\\\\n  address:\\\\n    socket_address:\\\\n      address: 0.0.0.0\\\\n      port_value: 8001\\\\n\\\\n\\\"},\\\"kind\\\":\\\"ConfigMap\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"name\\\":\\\"envoy-config\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"}}\\n\"},\"creationTimestamp\":\"2019-03-27T15:05:26Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"envoy-config\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"15700634\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/configmaps/envoy-config\",\"uid\":\"c0f7bfa3-50a1-11e9-9c81-06fb1f5bf244\"}}"},{"kind":"PersistentVolumeClaim","namespace":"fdp-connectivity-web-service-integration-usw2-prd-prd","name":"web-service-integration-efs-pvc","targetState":"{\"apiVersion\":\"v1\",\"kind\":\"PersistentVolumeClaim\",\"metadata\":{\"annotations\":{\"volume.beta.kubernetes.io/storage-class\":\"aws-efs\"},\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"web-service-integration-efs-pvc\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"accessModes\":[\"ReadWriteMany\"],\"resources\":{\"requests\":{\"storage\":\"1Mi\"}}}}","liveState":"{\"apiVersion\":\"v1\",\"kind\":\"PersistentVolumeClaim\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"PersistentVolumeClaim\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"volume.beta.kubernetes.io/storage-class\\\":\\\"aws-efs\\\"},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"name\\\":\\\"web-service-integration-efs-pvc\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"spec\\\":{\\\"accessModes\\\":[\\\"ReadWriteMany\\\"],\\\"resources\\\":{\\\"requests\\\":{\\\"storage\\\":\\\"1Mi\\\"}}}}\\n\",\"pv.kubernetes.io/bind-completed\":\"yes\",\"pv.kubernetes.io/bound-by-controller\":\"yes\",\"volume.beta.kubernetes.io/storage-class\":\"aws-efs\",\"volume.beta.kubernetes.io/storage-provisioner\":\"intuit.com/aws-efs\"},\"creationTimestamp\":\"2019-06-06T16:35:47Z\",\"finalizers\":[\"kubernetes.io/pvc-protection\"],\"labels\":{\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"name\":\"web-service-integration-efs-pvc\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"35729310\",\"selfLink\":\"/api/v1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/persistentvolumeclaims/web-service-integration-efs-pvc\",\"uid\":\"22f9269a-8879-11e9-8bb1-06df8347753a\"},\"spec\":{\"accessModes\":[\"ReadWriteMany\"],\"dataSource\":null,\"resources\":{\"requests\":{\"storage\":\"1Mi\"}},\"volumeMode\":\"Filesystem\",\"volumeName\":\"pvc-22f9269a-8879-11e9-8bb1-06df8347753a\"},\"status\":{\"accessModes\":[\"ReadWriteMany\"],\"capacity\":{\"storage\":\"1Mi\"},\"phase\":\"Bound\"}}"}]}`

//Test HPA and noReplicas applied
func TestRolloutWithReplicas(t *testing.T) {
	diffs := toResourceDiffs(t, rolloutWithReplicas)
	_, names, deploys, result := verifyHpa(diffs)
	assert.EqualValues(t, result, 0)

	applyLastAppliedConfigPatch(nil, nil, "fdp-connectivity-web-service-integration-usw2-prd-prd", names, deploys, true)
}

// Enable HPA
const RegularIngress = `
{
  "items": [
    {
      "group": "extensions",
      "kind": "Ingress",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-ingress",
      "targetState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}",
      "liveState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"
    },
    {
      "kind": "Service",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-service",
      "targetState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}",
      "liveState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"
    },
    {
      "group": "apps",
      "kind": "Deployment",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-deployment",
      "targetState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}",
      "liveState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"replicas\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":50,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258543579\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":3,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":3,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":50,\"readyReplicas\":3,\"replicas\":3,\"updatedReplicas\":3}}",
      "diff": "{\n  \"spec\": {\n    \"replicas\": [\n      3,\n      0,\n      0\n    ]\n  }\n}\n"
    }
  ]
}
`

func TestRegularIngress(t *testing.T) {
	diffs := toResourceDiffs(t, RegularIngress)
	result := verifyIngress(diffs)
	assert.EqualValues(t, result, 0)
}

const RegularIngressWithInstance = `
{
  "items": [
    {
      "group": "extensions",
      "kind": "Ingress",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-ingress",
      "targetState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/target-type\":\"instance\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}",
      "liveState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"
    },
    {
      "kind": "Service",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-service",
      "targetState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}",
      "liveState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"
    },
    {
      "group": "apps",
      "kind": "Deployment",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-deployment",
      "targetState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}",
      "liveState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"replicas\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":50,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258543579\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":3,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":3,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":50,\"readyReplicas\":3,\"replicas\":3,\"updatedReplicas\":3}}",
      "diff": "{\n  \"spec\": {\n    \"replicas\": [\n      3,\n      0,\n      0\n    ]\n  }\n}\n"
    }
  ]
}
`

func TestRegularIngressWithInstance(t *testing.T) {
	diffs := toResourceDiffs(t, RegularIngressWithInstance)
	result := verifyIngress(diffs)
	assert.EqualValues(t, result, 0)
}

// IKS 2 ingress
const IKS2Ingress = `
{
  "items": [
    {
      "group": "extensions",
      "kind": "Ingress",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-ingress",
      "targetState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/target-type\":\"ip\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}",
      "liveState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"
    },
    {
      "kind": "Service",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-service",
      "targetState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}",
      "liveState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"
    },
    {
      "group": "apps",
      "kind": "Deployment",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-deployment",
      "targetState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}",
      "liveState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"replicas\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":50,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258543579\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":3,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":3,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":50,\"readyReplicas\":3,\"replicas\":3,\"updatedReplicas\":3}}",
      "diff": "{\n  \"spec\": {\n    \"replicas\": [\n      3,\n      0,\n      0\n    ]\n  }\n}\n"
    }
  ]
}
`

func TestIKS2Ingress(t *testing.T) {
	fakeExit := func(int) {
		panic(500)
	}
	patch := monkey.Patch(os.Exit, fakeExit)
	defer patch.Unpatch()

	f := func() {
		diffs := toResourceDiffs(t, IKS2Ingress)
		verifyIngress(diffs)
	}

	assert.PanicsWithValue(t, 500, f)
}

// IKS 2 ingress
const IKS2IngressWithPodReadinessGate = `
{
  "items": [
    {
      "group": "extensions",
      "kind": "Ingress",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-ingress",
      "targetState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/target-type\":\"ip\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}",
      "liveState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"
    },
    {
      "kind": "Service",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-service",
      "targetState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}",
      "liveState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"
    },
    {
      "group": "apps",
      "kind": "Deployment",
      "namespace": "dev-containers-hpa-samples-usw2-ppd-qal",
      "name": "hpa-samples-appd-deployment",
      "targetState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"readinessGates\":[{\"conditionType\": \"target-health.alb.ingress.k8s.aws/hpa-samples-appd-ingress_hpa-samples-appd-service_443\"}], \"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}}}",
      "liveState": "{\"apiVersion\":\"apps/v1beta2\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{\"deployment.kubernetes.io/revision\":\"5\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"apps/v1beta2\\\",\\\"kind\\\":\\\"Deployment\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"},\\\"name\\\":\\\"hpa-samples-appd-deployment\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"replicas\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"hpa-samples\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"https\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"assetId\\\":\\\"8215709212542571317\\\",\\\"env\\\":\\\"qal\\\",\\\"l1\\\":\\\"dev\\\",\\\"l2\\\":\\\"containers\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"dev\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"containers\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"test\\\",\\\"value\\\":\\\"1234\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":90,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"app\\\",\\\"ports\\\":[{\\\"containerPort\\\":8443,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8443,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":75,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"4096M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"hpa-samples\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"qal\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"8215709212542571317\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-dev\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-7r5ghd8djt0b\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"}]}}}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"generation\":50,\"labels\":{\"app\":\"hpa-samples\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"buildType\":\"maven\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"},\"name\":\"hpa-samples-appd-deployment\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"258543579\",\"selfLink\":\"/apis/apps/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/deployments/hpa-samples-appd-deployment\",\"uid\":\"a25c47e1-7da6-11e9-81a8-06f75ee834e4\"},\"spec\":{\"progressDeadlineSeconds\":600,\"replicas\":3,\"revisionHistoryLimit\":10,\"selector\":{\"matchLabels\":{\"app\":\"hpa-samples\"}},\"strategy\":{\"rollingUpdate\":{\"maxSurge\":\"25%\",\"maxUnavailable\":\"25%\"},\"type\":\"RollingUpdate\"},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-dev-containers-hpa-samples-usw2-ppd-qal\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"https\",\"prometheus.io/scrape\":\"true\"},\"creationTimestamp\":null,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"assetId\":\"8215709212542571317\",\"env\":\"qal\",\"l1\":\"dev\",\"l2\":\"containers\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"L1\",\"value\":\"dev\"},{\"name\":\"L2\",\"value\":\"containers\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-dev.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"test\",\"value\":\"1234\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/hpa-samples/service/hpa-samples:jenkins-dev-containers-hpa-samples-hpa-samples-master-42-ed343db\",\"imagePullPolicy\":\"IfNotPresent\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":90,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"app\",\"ports\":[{\"containerPort\":8443,\"name\":\"service\",\"protocol\":\"TCP\"},{\"containerPort\":8490,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8443,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":75,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"4096M\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"4096M\"}},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"dnsPolicy\":\"ClusterFirst\",\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"hpa-samples\"},{\"name\":\"APP_ENV\",\"value\":\"qal\"},{\"name\":\"ASSET_ID\",\"value\":\"8215709212542571317\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-dev\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::490747939488:role/shared.paas-preprod-west2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-7r5ghd8djt0b\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"segment-app-init\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"terminationGracePeriodSeconds\":30,\"volumes\":[{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"}]}}},\"status\":{\"availableReplicas\":3,\"conditions\":[{\"lastTransitionTime\":\"2019-05-23T22:03:45Z\",\"lastUpdateTime\":\"2019-06-03T21:01:25Z\",\"message\":\"ReplicaSet \\\"hpa-samples-appd-deployment-5947b8687f\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-03T21:31:08Z\",\"lastUpdateTime\":\"2019-06-03T21:31:08Z\",\"message\":\"Deployment has minimum availability.\",\"reason\":\"MinimumReplicasAvailable\",\"status\":\"True\",\"type\":\"Available\"}],\"observedGeneration\":50,\"readyReplicas\":3,\"replicas\":3,\"updatedReplicas\":3}}",
      "diff": "{\n  \"spec\": {\n    \"replicas\": [\n      3,\n      0,\n      0\n    ]\n  }\n}\n"
    }
  ]
}
`

func TestIKS2IngressWithPodReadinessGate(t *testing.T) {
	diffs := toResourceDiffs(t, IKS2IngressWithPodReadinessGate)
	result := verifyIngress(diffs)
	assert.EqualValues(t, result, 0)
}

const ingressAndRollout = `
{
  "items": [
    {
      "group": "extensions",
      "kind": "Ingress",
      "namespace": "fdp-connectivity-web-service-integration-usw2-prd-prd",
      "name": "hpa-samples-appd-ingress",
      "targetState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/target-type\":\"ip\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]}}",
      "liveState": "{\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"alb.ingress.kubernetes.io/backend-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/certificate-arn\":\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\",\"alb.ingress.kubernetes.io/healthcheck-path\":\"/health/full\",\"alb.ingress.kubernetes.io/healthcheck-protocol\":\"HTTPS\",\"alb.ingress.kubernetes.io/listen-ports\":\"[{\\\"HTTPS\\\": 443}]\",\"alb.ingress.kubernetes.io/load-balancer-attributes\":\"access_logs.s3.enabled=false\",\"alb.ingress.kubernetes.io/scheme\":\"internet-facing\",\"alb.ingress.kubernetes.io/security-groups\":\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\",\"alb.ingress.kubernetes.io/ssl-policy\":\"ELBSecurityPolicy-TLS-1-2-2017-01\",\"alb.ingress.kubernetes.io/subnets\":\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\",\"external-dns.alpha.kubernetes.io/hostname\":\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\",\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"extensions/v1beta1\\\",\\\"kind\\\":\\\"Ingress\\\",\\\"metadata\\\":{\\\"annotations\\\":{\\\"alb.ingress.kubernetes.io/backend-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/certificate-arn\\\":\\\"arn:aws:acm:us-west-2:490747939488:certificate/c60e4e8c-5ea2-46ff-a9a0-248436fc06a5\\\",\\\"alb.ingress.kubernetes.io/healthcheck-path\\\":\\\"/health/full\\\",\\\"alb.ingress.kubernetes.io/healthcheck-protocol\\\":\\\"HTTPS\\\",\\\"alb.ingress.kubernetes.io/listen-ports\\\":\\\"[{\\\\\\\"HTTPS\\\\\\\": 443}]\\\",\\\"alb.ingress.kubernetes.io/load-balancer-attributes\\\":\\\"access_logs.s3.enabled=false\\\",\\\"alb.ingress.kubernetes.io/scheme\\\":\\\"internet-facing\\\",\\\"alb.ingress.kubernetes.io/security-groups\\\":\\\"iks-intuit-cidr-ingress-tcp-443, iks-intuit-api-gw-ingress-preprod-tcp-443, iks-intuit-app-alb-custom-ingress, iks-intuit-ibp-ingress-tcp-443\\\",\\\"alb.ingress.kubernetes.io/ssl-policy\\\":\\\"ELBSecurityPolicy-TLS-1-2-2017-01\\\",\\\"alb.ingress.kubernetes.io/subnets\\\":\\\"IngressSubnetAz1, IngressSubnetAz2, IngressSubnetAz3\\\",\\\"external-dns.alpha.kubernetes.io/hostname\\\":\\\"dev-containers-qal-hpa-samples.paas-preprod-west.a.intuit.com\\\",\\\"kubernetes.io/ingress.class\\\":\\\"aws-alb\\\"},\\\"labels\\\":{\\\"app\\\":\\\"hpa-samples\\\",\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"name\\\":\\\"hpa-samples-appd-ingress\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"rules\\\":[{\\\"http\\\":{\\\"paths\\\":[{\\\"backend\\\":{\\\"serviceName\\\":\\\"hpa-samples-appd-service\\\",\\\"servicePort\\\":443},\\\"path\\\":\\\"/*\\\"}]}}]}}\\n\",\"kubernetes.io/ingress.class\":\"aws-alb\"},\"creationTimestamp\":\"2019-06-02T07:49:20Z\",\"generation\":2,\"labels\":{\"app\":\"hpa-samples\",\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"name\":\"hpa-samples-appd-ingress\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"257218198\",\"selfLink\":\"/apis/extensions/v1beta1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/ingresses/hpa-samples-appd-ingress\",\"uid\":\"ee715459-850a-11e9-81a8-06f75ee834e4\"},\"spec\":{\"rules\":[{\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"hpa-samples-appd-service\",\"servicePort\":443},\"path\":\"/*\"}]}}]},\"status\":{\"loadBalancer\":{\"ingress\":[{\"hostname\":\"paaspreprod-devcontainersh-bec3-1650558956.us-west-2.elb.amazonaws.com\"}]}}}"
    },
    {
      "kind": "Service",
      "namespace": "fdp-connectivity-web-service-integration-usw2-prd-prd",
      "name": "hpa-samples-appd-service",
      "targetState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\"},\"spec\":{\"ports\":[{\"name\":\"service\",\"port\":443,\"targetPort\":8443},{\"name\":\"iks-metric\",\"port\":8490,\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"type\":\"NodePort\"}}",
      "liveState": "{\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"v1\\\",\\\"kind\\\":\\\"Service\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"applications.argoproj.io/app-name\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\",\\\"iks-metric\\\":\\\"actuator-prometheus\\\"},\\\"name\\\":\\\"hpa-samples-appd-service\\\",\\\"namespace\\\":\\\"dev-containers-hpa-samples-usw2-ppd-qal\\\"},\\\"spec\\\":{\\\"ports\\\":[{\\\"name\\\":\\\"service\\\",\\\"port\\\":443,\\\"targetPort\\\":8443},{\\\"name\\\":\\\"iks-metric\\\",\\\"port\\\":8490,\\\"targetPort\\\":8490}],\\\"selector\\\":{\\\"app\\\":\\\"hpa-samples\\\"},\\\"type\\\":\\\"NodePort\\\"}}\\n\"},\"creationTimestamp\":\"2019-05-23T22:03:45Z\",\"labels\":{\"applications.argoproj.io/app-name\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"iks-metric\":\"actuator-prometheus\"},\"name\":\"hpa-samples-appd-service\",\"namespace\":\"dev-containers-hpa-samples-usw2-ppd-qal\",\"resourceVersion\":\"249265864\",\"selfLink\":\"/api/v1/namespaces/dev-containers-hpa-samples-usw2-ppd-qal/services/hpa-samples-appd-service\",\"uid\":\"a23d282c-7da6-11e9-ad6f-0a4b8fec9f72\"},\"spec\":{\"clusterIP\":\"100.69.146.135\",\"externalTrafficPolicy\":\"Cluster\",\"ports\":[{\"name\":\"service\",\"nodePort\":31309,\"port\":443,\"protocol\":\"TCP\",\"targetPort\":8443},{\"name\":\"iks-metric\",\"nodePort\":30832,\"port\":8490,\"protocol\":\"TCP\",\"targetPort\":8490}],\"selector\":{\"app\":\"hpa-samples\"},\"sessionAffinity\":\"None\",\"type\":\"NodePort\"},\"status\":{\"loadBalancer\":{}}}"
    },
    {
      "group": "argoproj.io",
      "kind": "Rollout",
      "namespace": "fdp-connectivity-web-service-integration-usw2-prd-prd",
      "name": "web-service-integration",
      "targetState": "{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"metadata\":{\"labels\":{\"app\":\"web-service-integration\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\"},\"spec\":{\"revisionHistoryLimit\":3,\"selector\":{\"matchLabels\":{\"app\":\"web-service-integration\"}},\"strategy\":{\"blueGreen\":{\"activeService\":\"active-web-service-integration\",\"autoPromotionEnabled\":false,\"previewService\":\"preview-web-service-integration\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"HTTP\",\"prometheus.io/scrape\":\"true\",\"splunk-sourcetype\":\"{\\\"wsi-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"} , \\\"perflog-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsiperf\\\", \\\"stderr\\\": \\\"fdpwsiperf\\\"} , \\\"oil-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsioil\\\", \\\"stderr\\\": \\\"fdpwsioil\\\"}, \\\"cgds-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsicgds\\\", \\\"stderr\\\": \\\"fdpwsicgds\\\"}}\"},\"labels\":{\"app\":\"web-service-integration\",\"assetId\":\"5766876915036502990\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"wsi\"}},\"spec\":{\"readinessGates\":[{\"conditionType\": \"target-health.alb.ingress.k8s.aws/hpa-samples-appd-ingress_hpa-samples-appd-service_443\"}], \"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"APP_ENV_PROPERTIES\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"L1\",\"value\":\"fdp\"},{\"name\":\"L2\",\"value\":\"connectivity\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app-iks\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-prod.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"web-service-integration\",\"ports\":[{\"containerPort\":8080,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"12G\"},\"requests\":{\"cpu\":\"2\",\"memory\":\"12G\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/usr/local/tomcat/logs/\",\"name\":\"varlog\"},{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice-perf.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"perflog-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsi-oil.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"oil-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"wsi-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/cgds\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"cgds-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"100m\",\"memory\":\"64M\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"64M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"env\":[{\"name\":\"IDPS_APPLIANCE_URL\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"SEC_TOOLS_SECRETS_ROOT_DIR\",\"value\":\"/secrets/sigsci-agent\"}],\"image\":\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\",\"name\":\"sigsci-agent-container\",\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"400Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"}]},{\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"envoy-proxy\",\"ports\":[{\"containerPort\":443,\"name\":\"envoy-service\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"400m\",\"memory\":\"1500M\"},\"requests\":{\"cpu\":\"400m\",\"memory\":\"1500M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/envoy\",\"name\":\"envoy-config\",\"readOnly\":true},{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-6b7athiqaksu\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-l\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/application_secrets.properties\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-secrets\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"configMap\":{\"items\":[{\"key\":\"envoy.yaml\",\"path\":\"envoy.yaml\"}],\"name\":\"envoy-config\"},\"name\":\"envoy-config\"},{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"emptyDir\":{},\"name\":\"varlog\"},{\"emptyDir\":{},\"name\":\"sigscisharedvolume\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}}}",
      "liveState": "{\"apiVersion\":\"argoproj.io/v1alpha1\",\"kind\":\"Rollout\",\"metadata\":{\"annotations\":{\"kubectl.kubernetes.io/last-applied-configuration\":\"{\\\"apiVersion\\\":\\\"argoproj.io/v1alpha1\\\",\\\"kind\\\":\\\"Rollout\\\",\\\"metadata\\\":{\\\"annotations\\\":{},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"appType\\\":\\\"spring-boot\\\",\\\"applications.argoproj.io/app-name\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"buildType\\\":\\\"maven\\\",\\\"env\\\":\\\"prd\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\"},\\\"name\\\":\\\"web-service-integration\\\",\\\"namespace\\\":\\\"fdp-connectivity-web-service-integration-usw2-prd-prd\\\"},\\\"spec\\\":{\\\"replicas\\\":9,\\\"revisionHistoryLimit\\\":3,\\\"selector\\\":{\\\"matchLabels\\\":{\\\"app\\\":\\\"web-service-integration\\\"}},\\\"strategy\\\":{\\\"blueGreen\\\":{\\\"activeService\\\":\\\"active-web-service-integration\\\",\\\"previewService\\\":\\\"preview-web-service-integration\\\"}},\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"iam.amazonaws.com/role\\\":\\\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\\\",\\\"prometheus.io/path\\\":\\\"/actuator/prometheus\\\",\\\"prometheus.io/port\\\":\\\"8490\\\",\\\"prometheus.io/scheme\\\":\\\"HTTP\\\",\\\"prometheus.io/scrape\\\":\\\"true\\\",\\\"splunk-sourcetype\\\":\\\"{\\\\\\\"wsi-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsi\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsi\\\\\\\"} , \\\\\\\"perflog-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsiperf\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsiperf\\\\\\\"} , \\\\\\\"oil-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsioil\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsioil\\\\\\\"}, \\\\\\\"cgds-sidecar\\\\\\\": {\\\\\\\"stdout\\\\\\\": \\\\\\\"fdpwsicgds\\\\\\\", \\\\\\\"stderr\\\\\\\": \\\\\\\"fdpwsicgds\\\\\\\"}}\\\"},\\\"labels\\\":{\\\"app\\\":\\\"web-service-integration\\\",\\\"assetId\\\":\\\"5766876915036502990\\\",\\\"env\\\":\\\"prd\\\",\\\"l1\\\":\\\"fdp\\\",\\\"l2\\\":\\\"connectivity\\\",\\\"splunk-index\\\":\\\"wsi\\\"}},\\\"spec\\\":{\\\"containers\\\":[{\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"APP_ENV_PROPERTIES\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"L1\\\",\\\"value\\\":\\\"fdp\\\"},{\\\"name\\\":\\\"L2\\\",\\\"value\\\":\\\"connectivity\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_TIER_NAME\\\",\\\"value\\\":\\\"app-iks\\\"},{\\\"name\\\":\\\"APPDYNAMICS_CONTROLLER_HOST_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod.saas.appdynamics.com\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8080,\\\"scheme\\\":\\\"HTTP\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"web-service-integration\\\",\\\"ports\\\":[{\\\"containerPort\\\":8080,\\\"name\\\":\\\"service\\\"},{\\\"containerPort\\\":8490,\\\"name\\\":\\\"metrics\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8080,\\\"scheme\\\":\\\"HTTP\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"2\\\",\\\"memory\\\":\\\"10G\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"2\\\",\\\"memory\\\":\\\"10G\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"},{\\\"mountPath\\\":\\\"/usr/local/tomcat/logs/\\\",\\\"name\\\":\\\"varlog\\\"},{\\\"mountPath\\\":\\\"/var/run/sigsci\\\",\\\"name\\\":\\\"sigscisharedvolume\\\"},{\\\"mountPath\\\":\\\"/cgds\\\",\\\"name\\\":\\\"wsiefs\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsiservice-perf.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"perflog-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsi-oil.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"oil-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/wsiservice.log\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"wsi-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"args\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"tail -n+1 -F /var/log/cgds\\\"],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/base/alpine3:latest\\\",\\\"name\\\":\\\"cgds-sidecar\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"150m\\\",\\\"memory\\\":\\\"128M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/log/\\\",\\\"name\\\":\\\"varlog\\\"}]},{\\\"env\\\":[{\\\"name\\\":\\\"IDPS_APPLIANCE_URL\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"SEC_TOOLS_SECRETS_ROOT_DIR\\\",\\\"value\\\":\\\"/secrets/sigsci-agent\\\"}],\\\"image\\\":\\\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\\\",\\\"name\\\":\\\"sigsci-agent-container\\\",\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"512Mi\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"1\\\",\\\"memory\\\":\\\"512Mi\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/var/run/sigsci\\\",\\\"name\\\":\\\"sigscisharedvolume\\\"}]},{\\\"image\\\":\\\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\\\",\\\"livenessProbe\\\":{\\\"failureThreshold\\\":5,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8002,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":1,\\\"timeoutSeconds\\\":1},\\\"name\\\":\\\"envoy-proxy\\\",\\\"ports\\\":[{\\\"containerPort\\\":443,\\\"name\\\":\\\"envoy-service\\\"}],\\\"readinessProbe\\\":{\\\"failureThreshold\\\":3,\\\"httpGet\\\":{\\\"path\\\":\\\"/health/full\\\",\\\"port\\\":8002,\\\"scheme\\\":\\\"HTTPS\\\"},\\\"initialDelaySeconds\\\":300,\\\"periodSeconds\\\":5,\\\"successThreshold\\\":3,\\\"timeoutSeconds\\\":1},\\\"resources\\\":{\\\"limits\\\":{\\\"cpu\\\":\\\"500m\\\",\\\"memory\\\":\\\"1024M\\\"},\\\"requests\\\":{\\\"cpu\\\":\\\"500m\\\",\\\"memory\\\":\\\"1024M\\\"}},\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/envoy\\\",\\\"name\\\":\\\"envoy-config\\\",\\\"readOnly\\\":true},{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"initContainers\\\":[{\\\"args\\\":[\\\"-c\\\",\\\"/usr/local/bin/segment-app-init secrets get\\\"],\\\"command\\\":[\\\"/bin/sh\\\"],\\\"env\\\":[{\\\"name\\\":\\\"APP_NAME\\\",\\\"value\\\":\\\"web-service-integration\\\"},{\\\"name\\\":\\\"APP_ENV\\\",\\\"value\\\":\\\"prd\\\"},{\\\"name\\\":\\\"ASSET_ID\\\",\\\"value\\\":\\\"5766876915036502990\\\"},{\\\"name\\\":\\\"APPDYNAMICS_AGENT_ACCOUNT_NAME\\\",\\\"value\\\":\\\"intuit-ss-prod\\\"},{\\\"name\\\":\\\"SEGMENT_CLUSTER_ROLE_ARN\\\",\\\"value\\\":\\\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_APPLIANCE\\\",\\\"value\\\":\\\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"SEGMENT_IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-6b7athiqaksu\\\"}],\\\"image\\\":\\\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\\\",\\\"name\\\":\\\"segment-app-init\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-l\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/application_secrets.properties\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-secrets\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]},{\\\"args\\\":[\\\"-f\\\"],\\\"env\\\":[{\\\"name\\\":\\\"IDPS_ENDPOINT\\\",\\\"value\\\":\\\"wsi-production-qd1jef.pd.idps.a.intuit.com\\\"},{\\\"name\\\":\\\"IDPS_POLICY_ID\\\",\\\"value\\\":\\\"p-zw1vhqurfnp7\\\"},{\\\"name\\\":\\\"IDPS_SECRET_LOCATION\\\",\\\"value\\\":\\\"WSI_SECRETS_CERT\\\"},{\\\"name\\\":\\\"IDPS_SECRETS_OUTPUT_FILE\\\",\\\"value\\\":\\\"/etc/secrets/\\\"},{\\\"name\\\":\\\"IDPS_API_KEY\\\"},{\\\"name\\\":\\\"IDPS_API_KEY_FILEPATH\\\"}],\\\"image\\\":\\\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\\\",\\\"name\\\":\\\"idpsloader-cert\\\",\\\"volumeMounts\\\":[{\\\"mountPath\\\":\\\"/etc/secrets\\\",\\\"name\\\":\\\"secrets\\\"}]}],\\\"volumes\\\":[{\\\"configMap\\\":{\\\"items\\\":[{\\\"key\\\":\\\"envoy.yaml\\\",\\\"path\\\":\\\"envoy.yaml\\\"}],\\\"name\\\":\\\"envoy-config\\\"},\\\"name\\\":\\\"envoy-config\\\"},{\\\"emptyDir\\\":{\\\"medium\\\":\\\"Memory\\\"},\\\"name\\\":\\\"secrets\\\"},{\\\"emptyDir\\\":{},\\\"name\\\":\\\"varlog\\\"},{\\\"emptyDir\\\":{},\\\"name\\\":\\\"sigscisharedvolume\\\"},{\\\"name\\\":\\\"wsiefs\\\",\\\"persistentVolumeClaim\\\":{\\\"claimName\\\":\\\"web-service-integration-efs-pvc\\\"}}]}}}}\\n\",\"rollout.argoproj.io/revision\":\"20\"},\"creationTimestamp\":\"2019-05-15T19:26:41Z\",\"generation\":393,\"labels\":{\"app\":\"web-service-integration\",\"appType\":\"spring-boot\",\"applications.argoproj.io/app-name\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"assetId\":\"5766876915036502990\",\"buildType\":\"maven\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\"},\"name\":\"web-service-integration\",\"namespace\":\"fdp-connectivity-web-service-integration-usw2-prd-prd\",\"resourceVersion\":\"46391608\",\"selfLink\":\"/apis/argoproj.io/v1alpha1/namespaces/fdp-connectivity-web-service-integration-usw2-prd-prd/rollouts/web-service-integration\",\"uid\":\"5def8381-7747-11e9-88f6-029fb774bb1c\"},\"spec\":{\"minReadySeconds\":0,\"paused\":false,\"replicas\":9,\"revisionHistoryLimit\":3,\"selector\":{\"matchLabels\":{\"app\":\"web-service-integration\"}},\"strategy\":{\"blueGreen\":{\"activeService\":\"active-web-service-integration\",\"previewService\":\"preview-web-service-integration\"}},\"template\":{\"metadata\":{\"annotations\":{\"iam.amazonaws.com/role\":\"k8s-fdp-connectivity-web-service-integration-usw2-prd-prd\",\"prometheus.io/path\":\"/actuator/prometheus\",\"prometheus.io/port\":\"8490\",\"prometheus.io/scheme\":\"HTTP\",\"prometheus.io/scrape\":\"true\",\"splunk-sourcetype\":\"{\\\"wsi-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsi\\\", \\\"stderr\\\": \\\"fdpwsi\\\"} , \\\"perflog-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsiperf\\\", \\\"stderr\\\": \\\"fdpwsiperf\\\"} , \\\"oil-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsioil\\\", \\\"stderr\\\": \\\"fdpwsioil\\\"}, \\\"cgds-sidecar\\\": {\\\"stdout\\\": \\\"fdpwsicgds\\\", \\\"stderr\\\": \\\"fdpwsicgds\\\"}}\"},\"labels\":{\"app\":\"web-service-integration\",\"assetId\":\"5766876915036502990\",\"env\":\"prd\",\"l1\":\"fdp\",\"l2\":\"connectivity\",\"splunk-index\":\"wsi\"}},\"spec\":{\"containers\":[{\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"APP_ENV_PROPERTIES\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"L1\",\"value\":\"fdp\"},{\"name\":\"L2\",\"value\":\"connectivity\"},{\"name\":\"APPDYNAMICS_AGENT_TIER_NAME\",\"value\":\"app-iks\"},{\"name\":\"APPDYNAMICS_CONTROLLER_HOST_NAME\",\"value\":\"intuit-ss-prod.saas.appdynamics.com\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"}],\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"web-service-integration\",\"ports\":[{\"containerPort\":8080,\"name\":\"service\"},{\"containerPort\":8490,\"name\":\"metrics\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8080,\"scheme\":\"HTTP\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"10G\"},\"requests\":{\"cpu\":\"2\",\"memory\":\"10G\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"},{\"mountPath\":\"/usr/local/tomcat/logs/\",\"name\":\"varlog\"},{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"},{\"mountPath\":\"/cgds\",\"name\":\"wsiefs\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice-perf.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"perflog-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsi-oil.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"oil-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/wsiservice.log\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"wsi-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"args\":[\"/bin/sh\",\"-c\",\"tail -n+1 -F /var/log/cgds\"],\"image\":\"docker.intuit.com/oicp/standard/base/alpine3:latest\",\"name\":\"cgds-sidecar\",\"resources\":{\"limits\":{\"cpu\":\"150m\",\"memory\":\"128M\"},\"requests\":{\"cpu\":\"150m\",\"memory\":\"128M\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log/\",\"name\":\"varlog\"}]},{\"env\":[{\"name\":\"IDPS_APPLIANCE_URL\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"SEC_TOOLS_SECRETS_ROOT_DIR\",\"value\":\"/secrets/sigsci-agent\"}],\"image\":\"docker.intuit.com/oicp/standard/sigsci-agent-3.x/alpine3-sigsci-agent:latest\",\"name\":\"sigsci-agent-container\",\"resources\":{\"limits\":{\"cpu\":\"1\",\"memory\":\"512Mi\"},\"requests\":{\"cpu\":\"1\",\"memory\":\"512Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/run/sigsci\",\"name\":\"sigscisharedvolume\"}]},{\"image\":\"docker.artifactory.a.intuit.com/fdp/connectivity/web-service-integration/service/web-service-integration-envoy:jenkins-fdp-connectivity-web-service-integration-web-service-integration-master-670-7d1c998\",\"livenessProbe\":{\"failureThreshold\":5,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":1,\"timeoutSeconds\":1},\"name\":\"envoy-proxy\",\"ports\":[{\"containerPort\":443,\"name\":\"envoy-service\"}],\"readinessProbe\":{\"failureThreshold\":3,\"httpGet\":{\"path\":\"/health/full\",\"port\":8002,\"scheme\":\"HTTPS\"},\"initialDelaySeconds\":300,\"periodSeconds\":5,\"successThreshold\":3,\"timeoutSeconds\":1},\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"1024M\"},\"requests\":{\"cpu\":\"500m\",\"memory\":\"1024M\"}},\"volumeMounts\":[{\"mountPath\":\"/etc/envoy\",\"name\":\"envoy-config\",\"readOnly\":true},{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"initContainers\":[{\"args\":[\"-c\",\"/usr/local/bin/segment-app-init secrets get\"],\"command\":[\"/bin/sh\"],\"env\":[{\"name\":\"APP_NAME\",\"value\":\"web-service-integration\"},{\"name\":\"APP_ENV\",\"value\":\"prd\"},{\"name\":\"ASSET_ID\",\"value\":\"5766876915036502990\"},{\"name\":\"APPDYNAMICS_AGENT_ACCOUNT_NAME\",\"value\":\"intuit-ss-prod\"},{\"name\":\"SEGMENT_CLUSTER_ROLE_ARN\",\"value\":\"arn:aws:iam::145535350597:role/shared.ifdp-prod-pci-usw2.cluster.k8s.local\"},{\"name\":\"SEGMENT_IDPS_APPLIANCE\",\"value\":\"Paask8s-PRODUCTION-V8NVUY.pd.idps.a.intuit.com\"},{\"name\":\"SEGMENT_IDPS_POLICY_ID\",\"value\":\"p-6b7athiqaksu\"}],\"image\":\"docker.artifactory.a.intuit.com/dev/containers/segment-app-init/service/segment-app-init:master-32-5319a9b\",\"name\":\"segment-app-init\",\"resources\":{},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-l\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/application_secrets.properties\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-secrets\",\"resources\":{},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]},{\"args\":[\"-f\"],\"env\":[{\"name\":\"IDPS_ENDPOINT\",\"value\":\"wsi-production-qd1jef.pd.idps.a.intuit.com\"},{\"name\":\"IDPS_POLICY_ID\",\"value\":\"p-zw1vhqurfnp7\"},{\"name\":\"IDPS_SECRET_LOCATION\",\"value\":\"WSI_SECRETS_CERT\"},{\"name\":\"IDPS_SECRETS_OUTPUT_FILE\",\"value\":\"/etc/secrets/\"},{\"name\":\"IDPS_API_KEY\"},{\"name\":\"IDPS_API_KEY_FILEPATH\"}],\"image\":\"docker.intuit.com/fdp/connectivity/web-service-integration/service/idps-loader:4d09c03\",\"name\":\"idpsloader-cert\",\"resources\":{},\"volumeMounts\":[{\"mountPath\":\"/etc/secrets\",\"name\":\"secrets\"}]}],\"volumes\":[{\"configMap\":{\"items\":[{\"key\":\"envoy.yaml\",\"path\":\"envoy.yaml\"}],\"name\":\"envoy-config\"},\"name\":\"envoy-config\"},{\"emptyDir\":{\"medium\":\"Memory\"},\"name\":\"secrets\"},{\"emptyDir\":{},\"name\":\"varlog\"},{\"emptyDir\":{},\"name\":\"sigscisharedvolume\"},{\"name\":\"wsiefs\",\"persistentVolumeClaim\":{\"claimName\":\"web-service-integration-efs-pvc\"}}]}}},\"status\":{\"HPAReplicas\":9,\"availableReplicas\":9,\"blueGreen\":{\"activeSelector\":\"6d99444d55\"},\"canary\":{},\"conditions\":[{\"lastTransitionTime\":\"2019-06-20T01:11:49Z\",\"lastUpdateTime\":\"2019-06-20T01:11:49Z\",\"message\":\"ReplicaSet \\\"web-service-integration-6d99444d55\\\" has successfully progressed.\",\"reason\":\"NewReplicaSetAvailable\",\"status\":\"True\",\"type\":\"Progressing\"},{\"lastTransitionTime\":\"2019-06-21T02:48:17Z\",\"lastUpdateTime\":\"2019-06-21T02:48:17Z\",\"message\":\"Rollout has minimum availability\",\"reason\":\"AvailableReason\",\"status\":\"True\",\"type\":\"Available\"}],\"currentPodHash\":\"6d99444d55\",\"observedGeneration\":\"865fd7fd8\",\"readyReplicas\":9,\"replicas\":9,\"selector\":\"app=web-service-integration,rollouts-pod-template-hash=6d99444d55\",\"updatedReplicas\":9}}",
      "diff": "{\n  \"spec\": {\n    \"strategy\": {\n      \"blueGreen\": {\n        \"autoPromotionEnabled\": [\n          false\n        ]\n      }\n    },\n    \"template\": {\n      \"spec\": {\n        \"containers\": {\n          \"0\": {\n            \"resources\": {\n              \"limits\": {\n                \"memory\": [\n                  \"10G\",\n                  \"12G\"\n                ]\n              },\n              \"requests\": {\n                \"memory\": [\n                  \"10G\",\n                  \"12G\"\n                ]\n              }\n            }\n          },\n          \"1\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"2\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"3\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"4\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"150m\",\n                  \"100m\"\n                ],\n                \"memory\": [\n                  \"128M\",\n                  \"64M\"\n                ]\n              }\n            }\n          },\n          \"5\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"1\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"512Mi\",\n                  \"400Mi\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"1\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"512Mi\",\n                  \"400Mi\"\n                ]\n              }\n            }\n          },\n          \"6\": {\n            \"resources\": {\n              \"limits\": {\n                \"cpu\": [\n                  \"500m\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"1024M\",\n                  \"1500M\"\n                ]\n              },\n              \"requests\": {\n                \"cpu\": [\n                  \"500m\",\n                  \"400m\"\n                ],\n                \"memory\": [\n                  \"1024M\",\n                  \"1500M\"\n                ]\n              }\n            }\n          },\n          \"_t\": \"a\"\n        }\n      }\n    }\n  }\n}\n"
    }
  ]
}
`

//Test HPA and noReplicas applied
func TestIngressAndRollout(t *testing.T) {
	diffs := toResourceDiffs(t, ingressAndRollout)
	result := verifyIngress(diffs)
	assert.EqualValues(t, result, 0)

}
